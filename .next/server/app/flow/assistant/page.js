(()=>{var e={};e.id=255,e.ids=[255],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},73169:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>r.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),i(82460),i(94347),i(52593);var s=i(93826),n=i(49930),o=i(42049),r=i.n(o),a=i(88405),l={};for(let e in a)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);i.d(t,l);let c=["",{children:["flow",{children:["assistant",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,82460)),"C:\\Bollo\\Github\\flowstate-catalyst\\src\\app\\flow\\assistant\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,94347)),"C:\\Bollo\\Github\\flowstate-catalyst\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,52593,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Bollo\\Github\\flowstate-catalyst\\src\\app\\flow\\assistant\\page.tsx"],u="/flow/assistant/page",h={require:i,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/flow/assistant/page",pathname:"/flow/assistant",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7069:(e,t,i)=>{Promise.resolve().then(i.bind(i,97582))},97582:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ev});var s,n,o,r,a,l,c,d,u,h,p,m,f=i(31694),g=i(65650),y=i.n(g);(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(s||(s={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(n||(n={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(o||(o={}));let v=["user","model","function","system"];(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(r||(r={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(a||(a={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(l||(l={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(c||(c={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"}(d||(d={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(u||(u={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(h||(h={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(p||(p={}));class w extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class _ extends w{constructor(e,t){super(e),this.response=t}}class E extends w{constructor(e,t,i,s){super(e),this.status=t,this.statusText=i,this.errorDetails=s}}class b extends w{}class C extends w{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(m||(m={}));class T{constructor(e,t,i,s,n){this.model=e,this.task=t,this.apiKey=i,this.stream=s,this.requestOptions=n}toString(){var e,t;let i=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta",s=(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",n=`${s}/${i}/${this.model}:${this.task}`;return this.stream&&(n+="?alt=sse"),n}}async function x(e){var t;let i=new Headers;i.append("Content-Type","application/json"),i.append("x-goog-api-client",function(e){let t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.24.0"),t.join(" ")}(e.requestOptions)),i.append("x-goog-api-key",e.apiKey);let s=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(e){throw new b(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${e.message}`)}for(let[e,t]of s.entries()){if("x-goog-api-key"===e)throw new b(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new b(`Header name ${e} can only be set using the apiClient field`);i.append(e,t)}}return i}async function N(e,t,i,s,n,o){let r=new T(e,t,i,s,o);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.signal)!==void 0||(null==e?void 0:e.timeout)>=0){let i=new AbortController;(null==e?void 0:e.timeout)>=0&&setTimeout(()=>i.abort(),e.timeout),(null==e?void 0:e.signal)&&e.signal.addEventListener("abort",()=>{i.abort()}),t.signal=i.signal}return t}(o)),{method:"POST",headers:await x(r),body:n})}}async function I(e,t,i,s,n,o={},r=fetch){let{url:a,fetchOptions:l}=await N(e,t,i,s,n,o);return A(a,l,r)}async function A(e,t,i=fetch){let s;try{s=await i(e,t)}catch(t){(function(e,t){let i=e;throw"AbortError"===i.name?(i=new C(`Request aborted when fetching ${t.toString()}: ${e.message}`)).stack=e.stack:e instanceof E||e instanceof b||((i=new w(`Error fetching from ${t.toString()}: ${e.message}`)).stack=e.stack),i})(t,e)}return s.ok||await S(s,e),s}async function S(e,t){let i,s="";try{let t=await e.json();s=t.error.message,t.error.details&&(s+=` ${JSON.stringify(t.error.details)}`,i=t.error.details)}catch(e){}throw new E(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${s}`,e.status,e.statusText,i)}function O(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),D(e.candidates[0]))throw new _(`${P(e)}`,e);return function(e){var t,i,s,n;let o=[];if(null===(i=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===i?void 0:i.parts)for(let t of null===(n=null===(s=e.candidates)||void 0===s?void 0:s[0].content)||void 0===n?void 0:n.parts)t.text&&o.push(t.text),t.executableCode&&o.push("\n```"+t.executableCode.language+"\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&o.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}(e)}if(e.promptFeedback)throw new _(`Text not available. ${P(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),D(e.candidates[0]))throw new _(`${P(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),k(e)[0]}if(e.promptFeedback)throw new _(`Function call not available. ${P(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),D(e.candidates[0]))throw new _(`${P(e)}`,e);return k(e)}if(e.promptFeedback)throw new _(`Function call not available. ${P(e)}`,e)},e}function k(e){var t,i,s,n;let o=[];if(null===(i=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===i?void 0:i.parts)for(let t of null===(n=null===(s=e.candidates)||void 0===s?void 0:s[0].content)||void 0===n?void 0:n.parts)t.functionCall&&o.push(t.functionCall);return o.length>0?o:void 0}let j=[d.RECITATION,d.SAFETY,d.LANGUAGE];function D(e){return!!e.finishReason&&j.includes(e.finishReason)}function P(e){var t,i,s;let n="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)n+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(n+=` due to ${e.promptFeedback.blockReason}`),(null===(i=e.promptFeedback)||void 0===i?void 0:i.blockReasonMessage)&&(n+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null===(s=e.candidates)||void 0===s?void 0:s[0]){let t=e.candidates[0];D(t)&&(n+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(n+=`: ${t.finishMessage}`))}return n}function R(e){return this instanceof R?(this.v=e,this):new R(e)}"function"==typeof SuppressedError&&SuppressedError;let L=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function $(e){let t=[],i=e.getReader();for(;;){let{done:e,value:s}=await i.read();if(e)return O(function(e){let t=e[e.length-1],i={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates){let e=0;for(let s of t.candidates)if(i.candidates||(i.candidates=[]),i.candidates[e]||(i.candidates[e]={index:e}),i.candidates[e].citationMetadata=s.citationMetadata,i.candidates[e].groundingMetadata=s.groundingMetadata,i.candidates[e].finishReason=s.finishReason,i.candidates[e].finishMessage=s.finishMessage,i.candidates[e].safetyRatings=s.safetyRatings,s.content&&s.content.parts){i.candidates[e].content||(i.candidates[e].content={role:s.content.role||"user",parts:[]});let t={};for(let n of s.content.parts)n.text&&(t.text=n.text),n.functionCall&&(t.functionCall=n.functionCall),n.executableCode&&(t.executableCode=n.executableCode),n.codeExecutionResult&&(t.codeExecutionResult=n.codeExecutionResult),0===Object.keys(t).length&&(t.text=""),i.candidates[e].content.parts.push(t)}e++}t.usageMetadata&&(i.usageMetadata=t.usageMetadata)}return i}(t));t.push(s)}}async function M(e,t,i,s){return function(e){let[t,i]=(function(e){let t=e.getReader();return new ReadableStream({start(e){let i="";return function s(){return t.read().then(({value:t,done:n})=>{let o;if(n){if(i.trim()){e.error(new w("Failed to parse stream"));return}e.close();return}let r=(i+=t).match(L);for(;r;){try{o=JSON.parse(r[1])}catch(t){e.error(new w(`Error parsing JSON response: "${r[1]}"`));return}e.enqueue(o),r=(i=i.substring(r[0].length)).match(L)}return s()}).catch(e=>{let t=e;throw t.stack=e.stack,t="AbortError"===t.name?new C("Request aborted when reading from the stream"):new w("Error reading from the stream")})}()}})})(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))).tee();return{stream:function(e){return function(e,t,i){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,n=i.apply(e,t||[]),o=[];return s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s;function r(e){n[e]&&(s[e]=function(t){return new Promise(function(i,s){o.push([e,t,i,s])>1||a(e,t)})})}function a(e,t){try{var i;(i=n[e](t)).value instanceof R?Promise.resolve(i.value.v).then(l,c):d(o[0][2],i)}catch(e){d(o[0][3],e)}}function l(e){a("next",e)}function c(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:i}=yield R(t.read());if(i)break;yield yield R(O(e))}})}(t),response:$(i)}}(await I(t,m.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(i),s))}async function F(e,t,i,s){let n=await I(t,m.GENERATE_CONTENT,e,!1,JSON.stringify(i),s);return{response:O(await n.json())}}function U(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function G(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let i of e)"string"==typeof i?t.push({text:i}):t.push(i);return function(e){let t={role:"user",parts:[]},i={role:"function",parts:[]},s=!1,n=!1;for(let o of e)"functionResponse"in o?(i.parts.push(o),n=!0):(t.parts.push(o),s=!0);if(s&&n)throw new w("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!n)throw new w("No content is provided for sending chat message.");return s?t:i}(t)}function B(e){let t;return t=e.contents?e:{contents:[G(e)]},e.systemInstruction&&(t.systemInstruction=U(e.systemInstruction)),t}let z=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],H={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function q(e){var t;if(void 0===e.candidates||0===e.candidates.length)return!1;let i=null===(t=e.candidates[0])||void 0===t?void 0:t.content;if(void 0===i||void 0===i.parts||0===i.parts.length)return!1;for(let e of i.parts)if(void 0===e||0===Object.keys(e).length||void 0!==e.text&&""===e.text)return!1;return!0}let Y="SILENT_ERROR";class K{constructor(e,t,i,s={}){this.model=t,this.params=i,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==i?void 0:i.history)&&(function(e){let t=!1;for(let i of e){let{role:e,parts:s}=i;if(!t&&"user"!==e)throw new w(`First content should be with role 'user', got ${e}`);if(!v.includes(e))throw new w(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(v)}`);if(!Array.isArray(s))throw new w("Content should have 'parts' property with an array of Parts");if(0===s.length)throw new w("Each Content should have at least one part");let n={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of s)for(let t of z)t in e&&(n[t]+=1);let o=H[e];for(let t of z)if(!o.includes(t)&&n[t]>0)throw new w(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var i,s,n,o,r,a;let l;await this._sendPromise;let c=G(e),d={safetySettings:null===(i=this.params)||void 0===i?void 0:i.safetySettings,generationConfig:null===(s=this.params)||void 0===s?void 0:s.generationConfig,tools:null===(n=this.params)||void 0===n?void 0:n.tools,toolConfig:null===(o=this.params)||void 0===o?void 0:o.toolConfig,systemInstruction:null===(r=this.params)||void 0===r?void 0:r.systemInstruction,cachedContent:null===(a=this.params)||void 0===a?void 0:a.cachedContent,contents:[...this._history,c]},u=Object.assign(Object.assign({},this._requestOptions),t);return this._sendPromise=this._sendPromise.then(()=>F(this._apiKey,this.model,d,u)).then(e=>{var t;if(q(e.response)){this._history.push(c);let i=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(i)}else{let t=P(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}l=e}),await this._sendPromise,l}async sendMessageStream(e,t={}){var i,s,n,o,r,a;await this._sendPromise;let l=G(e),c={safetySettings:null===(i=this.params)||void 0===i?void 0:i.safetySettings,generationConfig:null===(s=this.params)||void 0===s?void 0:s.generationConfig,tools:null===(n=this.params)||void 0===n?void 0:n.tools,toolConfig:null===(o=this.params)||void 0===o?void 0:o.toolConfig,systemInstruction:null===(r=this.params)||void 0===r?void 0:r.systemInstruction,cachedContent:null===(a=this.params)||void 0===a?void 0:a.cachedContent,contents:[...this._history,l]},d=Object.assign(Object.assign({},this._requestOptions),t),u=M(this._apiKey,this.model,c,d);return this._sendPromise=this._sendPromise.then(()=>u).catch(e=>{throw Error(Y)}).then(e=>e.response).then(e=>{if(q(e)){this._history.push(l);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=P(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==Y&&console.error(e)}),u}}async function V(e,t,i,s){return(await I(t,m.COUNT_TOKENS,e,!1,JSON.stringify(i),s)).json()}async function J(e,t,i,s){return(await I(t,m.EMBED_CONTENT,e,!1,JSON.stringify(i),s)).json()}async function W(e,t,i,s){let n=i.requests.map(e=>Object.assign(Object.assign({},e),{model:t}));return(await I(t,m.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:n}),s)).json()}class X{constructor(e,t,i={}){this.apiKey=e,this._requestOptions=i,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=U(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var i;let s=B(e),n=Object.assign(Object.assign({},this._requestOptions),t);return F(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(i=this.cachedContent)||void 0===i?void 0:i.name},s),n)}async generateContentStream(e,t={}){var i;let s=B(e),n=Object.assign(Object.assign({},this._requestOptions),t);return M(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(i=this.cachedContent)||void 0===i?void 0:i.name},s),n)}startChat(e){var t;return new K(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){let i=function(e,t){var i;let s={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(i=null==t?void 0:t.cachedContent)||void 0===i?void 0:i.name,contents:[]},n=null!=e.generateContentRequest;if(e.contents){if(n)throw new b("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=e.contents}else if(n)s=Object.assign(Object.assign({},s),e.generateContentRequest);else{let t=G(e);s.contents=[t]}return{generateContentRequest:s}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return V(this.apiKey,this.model,i,s)}async embedContent(e,t={}){let i="string"==typeof e||Array.isArray(e)?{content:G(e)}:e,s=Object.assign(Object.assign({},this._requestOptions),t);return J(this.apiKey,this.model,i,s)}async batchEmbedContents(e,t={}){let i=Object.assign(Object.assign({},this._requestOptions),t);return W(this.apiKey,this.model,e,i)}}class Z{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new w("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new X(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,i){if(!e.name)throw new b("Cached content must contain a `name` field.");if(!e.model)throw new b("Cached content must contain a `model` field.");for(let i of["model","systemInstruction"])if((null==t?void 0:t[i])&&e[i]&&(null==t?void 0:t[i])!==e[i]){if("model"===i&&(t.model.startsWith("models/")?t.model.replace("models/",""):t.model)===(e.model.startsWith("models/")?e.model.replace("models/",""):e.model))continue;throw new b(`Different value for "${i}" specified in modelParams (${t[i]}) and cachedContent (${e[i]})`)}let s=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new X(this.apiKey,s,i)}}function Q(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let ee=function(e){return e.DENIED="denied",e.READ_ONLY="read_only",e.FULL_ACCESS="full_access",e.ASK_EVERY_TIME="ask_every_time",e}({});class et{static getInstance(){return et.instance||(et.instance=new et),et.instance}constructor(){Q(this,"settings",new Map),Q(this,"accessLog",[]),this.initializeDefaultSettings()}initializeDefaultSettings(){this.settings.set("google-drive",{integrationId:"google-drive",permissionLevel:ee.ASK_EVERY_TIME,allowedOperations:["list","read"],preferLocalProcessing:!0,anonymizeMetadata:!0,enableAuditLog:!0}),this.settings.set("dropbox",{integrationId:"dropbox",permissionLevel:ee.ASK_EVERY_TIME,allowedOperations:["list","read"],preferLocalProcessing:!0,anonymizeMetadata:!0,enableAuditLog:!0})}getPrivacySettings(e){return this.settings.get(e)}updatePrivacySettings(e){this.settings.set(e.integrationId,e)}isOperationAllowed(e,t,i){let s=this.settings.get(e);if(!s)return{allowed:!1,reason:`No privacy settings found for ${e}`};if(s.allowedOperations&&!s.allowedOperations.includes(t))return{allowed:!1,reason:`Operation '${t}' is not allowed for ${e}`};switch(s.permissionLevel){case ee.DENIED:return{allowed:!1,reason:`Access to ${e} is denied by user settings`};case ee.READ_ONLY:if("list"!==t&&"read"!==t)return{allowed:!1,reason:`Only read operations are allowed for ${e}`};break;case ee.ASK_EVERY_TIME:return{allowed:!0,requiresConfirmation:!0};case ee.FULL_ACCESS:}return s.deniedPaths&&s.deniedPaths.some(e=>i.startsWith(e))?{allowed:!1,reason:`Access to path '${i}' is explicitly denied`}:s.allowedPaths&&s.allowedPaths.length>0&&!s.allowedPaths.some(e=>i.startsWith(e))?{allowed:!1,reason:`Access to path '${i}' is not allowed`}:{allowed:!0}}logAccess(e){let t=this.settings.get(e.integrationId);t?.enableAuditLog&&(e.timestamp||(e.timestamp=new Date),this.accessLog.push(e),console.log("Access logged:",e))}getAccessLogs(e,t){let i=this.accessLog.filter(t=>t.integrationId===e).sort((e,t)=>{let i=e.timestamp?.getTime()||0;return(t.timestamp?.getTime()||0)-i});return t?i.slice(0,t):i}clearAccessLogs(e){this.accessLog=this.accessLog.filter(t=>t.integrationId!==e)}getPrivacySummary(){let e={};for(let[t,i]of this.settings.entries())e[t]={permissionLevel:i.permissionLevel,localProcessing:i.preferLocalProcessing||!1,anonymizeMetadata:i.anonymizeMetadata||!1,operations:i.allowedOperations||[],restrictedPaths:i.deniedPaths||[]};return e}}function ei(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Q(et,"instance",void 0);class es{constructor(){ei(this,"genAI",void 0),ei(this,"model",void 0),ei(this,"privacyManager",void 0);let e=process.env.NEXT_PUBLIC_GEMINI_API_KEY||"";this.genAI=new Z(e),this.model=this.genAI.getGenerativeModel({model:"gemini-flash"}),this.privacyManager=et.getInstance()}async analyzeContent(e){try{let t;let{content:i,contentType:s,sourceId:n,sourceProvider:o}=e;if("cloud"===s&&o){let e=this.privacyManager.isOperationAllowed(o,"read",n||"unknown");if(!e.allowed)throw Error(`Privacy restriction: ${e.reason}`);this.privacyManager.logAccess({integrationId:o,operation:"read",resourcePath:n||"unknown",allowed:!0,timestamp:new Date})}let r=i;if(o){let e=this.privacyManager.getPrivacySettings(o);e?.anonymizeMetadata&&(r=this.anonymizeContent(i))}let a="";switch(s){case"text":a=`Analyze the following text and extract actionable tasks, provide a summary, and any insights:

${r}`;break;case"file":a=`Analyze the following document content and extract actionable tasks, provide a summary, and any insights:

${r}`;break;case"email":a=`Analyze the following email and extract actionable tasks, identify deadlines, priorities, and provide a summary:

${r}`;break;case"cloud":a=`Analyze the following content from cloud storage and extract actionable tasks, provide a summary, and any insights:

${r}`}if(a+=`

For each task, please provide:
1. A clear title
2. A brief description (if applicable)
3. Priority level (High, Medium, Low)
4. Due date (if mentioned or can be inferred)

Format your response as structured data that can be parsed.`,o){let e=this.privacyManager.getPrivacySettings(o);e?.preferLocalProcessing&&console.log("Using local processing for content analysis")}t=await this.model.generateContent(a);let l=(await t.response).text();return this.processResponse(l,s)}catch(e){throw console.error("Error analyzing content with Gemini:",e),Error("Failed to analyze content. Please try again later.")}}anonymizeContent(e){let t=e.replace(/[\w.-]+@[\w.-]+\.[\w]{2,}/g,"[EMAIL]");return(t=(t=(t=(t=t.replace(/\b\d{3}[-.\s]?\d{3}[-.\s]?\d{4}\b/g,"[PHONE]")).replace(/(https?:\/\/[^\s]+)/g,"[URL]")).replace(/\b[A-Z][a-z]+\s[A-Z][a-z]+\b/g,"[NAME]")).replace(/\d+\s[A-Z][a-zA-Z\s]+,\s[A-Z][a-zA-Z\s]+,\s[A-Z]{2}\s\d{5}/g,"[ADDRESS]")).replace(/\b(?:Account|ID|User)\s*[:=]\s*[\w-]{5,}/gi,e=>(e.match(/\b(?:Account|ID|User)\s*[:=]\s*/i)?.[0]||"")+"[ID]")}processResponse(e,t){try{if(e.includes("{")&&e.includes("}"))try{let t=e.match(/\{[\s\S]*\}/);if(t){let e=t[0];return JSON.parse(e)}}catch(e){console.warn("Failed to parse JSON from response:",e)}let t={},i=e.match(/Summary:([^\n]*)(\n|$)/)||e.match(/^([^\n#]+)/)||e.match(/(?:^|\n)(?:Summary|Overview):?([^\n]+)/);i&&(t.summary=i[1].trim()),t.tasks=[];let s=e.split(/\n(?:Task|\d+\.|\*|-)\s*/).filter(Boolean);if(s.length>1){let e=s[0].length<100?1:0;for(let i=e;i<s.length;i++){let e=s[i],n={title:""},o=e.match(/^([^\n.]+)/);if(!o)continue;n.title=o[1].trim();let r=e.match(/(?:\n|\.)\s*([^\n]+)(?:\n|$)/);r&&(n.description=r[1].trim());let a=e.match(/priority\s*:?\s*(high|medium|low)/i);if(a){let e=a[1].toLowerCase();n.priority=e.charAt(0).toUpperCase()+e.slice(1)}let l=e.match(/(?:due|deadline|by)\s*:?\s*([^\n,]+)/i);l&&(n.dueDate=l[1].trim()),t.tasks.push(n)}}let n=e.match(/(?:Insights|Additional Notes|Recommendations):?([^#]+)(?:\n#|$)/);return n&&(t.insights=n[1].trim()),t}catch(e){return console.error("Error processing Gemini response:",e),{summary:"Failed to process the response properly.",tasks:[{title:"Review content manually",description:"The AI assistant could not properly parse the content.",priority:"Medium"}]}}}}var en=i(52166);function eo(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,s)}return i}function er(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(i),!0).forEach(function(t){var s,n;s=t,n=i[t],(s=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(s))in e?Object.defineProperty(e,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[s]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eo(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}let ea=({providerId:e,onClose:t,onSave:i})=>{let s=et.getInstance().getPrivacySettings(e)||{integrationId:e,permissionLevel:ee.ASK_EVERY_TIME,allowedOperations:["list","read"],preferLocalProcessing:!0,anonymizeMetadata:!0,enableAuditLog:!0},{0:n,1:o}=(0,f.useState)(er({},s)),r=e=>{o(t=>er(er({},t),{},{permissionLevel:e}))},a=e=>{o(t=>er(er({},t),{},{[e]:!t[e]}))};return en.jsx("div",{className:y().privacyDialog,children:(0,en.jsxs)("div",{className:y().privacyDialogContent,children:[(0,en.jsxs)("h3",{children:["Privacy Settings for ",e]}),(0,en.jsxs)("div",{className:y().settingSection,children:[en.jsx("h4",{children:"Permission Level"}),(0,en.jsxs)("div",{className:y().radioGroup,children:[(0,en.jsxs)("label",{className:y().radioLabel,children:[en.jsx("input",{type:"radio",name:"permissionLevel",checked:n.permissionLevel===ee.DENIED,onChange:()=>r(ee.DENIED)}),"Denied (No Access)"]}),en.jsx("p",{className:y().settingDescription,children:"The application will not be able to access this storage provider."}),(0,en.jsxs)("label",{className:y().radioLabel,children:[en.jsx("input",{type:"radio",name:"permissionLevel",checked:n.permissionLevel===ee.READ_ONLY,onChange:()=>r(ee.READ_ONLY)}),"Read Only"]}),en.jsx("p",{className:y().settingDescription,children:"The application can only read files, not modify or delete them."}),(0,en.jsxs)("label",{className:y().radioLabel,children:[en.jsx("input",{type:"radio",name:"permissionLevel",checked:n.permissionLevel===ee.ASK_EVERY_TIME,onChange:()=>r(ee.ASK_EVERY_TIME)}),"Ask Every Time"]}),en.jsx("p",{className:y().settingDescription,children:"You will be prompted for permission each time the application needs to access files."}),(0,en.jsxs)("label",{className:y().radioLabel,children:[en.jsx("input",{type:"radio",name:"permissionLevel",checked:n.permissionLevel===ee.FULL_ACCESS,onChange:()=>r(ee.FULL_ACCESS)}),"Full Access"]}),en.jsx("p",{className:y().settingDescription,children:"The application has full access to this storage provider."})]})]}),(0,en.jsxs)("div",{className:y().settingSection,children:[en.jsx("h4",{children:"Privacy Options"}),(0,en.jsxs)("label",{className:y().checkboxLabel,children:[en.jsx("input",{type:"checkbox",checked:n.preferLocalProcessing,onChange:()=>a("preferLocalProcessing")}),"Process files locally when possible"]}),en.jsx("p",{className:y().settingDescription,children:"Files will be processed on your device instead of being sent to external servers when possible."}),(0,en.jsxs)("label",{className:y().checkboxLabel,children:[en.jsx("input",{type:"checkbox",checked:n.anonymizeMetadata,onChange:()=>a("anonymizeMetadata")}),"Anonymize file metadata"]}),en.jsx("p",{className:y().settingDescription,children:"Remove personally identifiable information from file metadata."}),(0,en.jsxs)("label",{className:y().checkboxLabel,children:[en.jsx("input",{type:"checkbox",checked:n.enableAuditLog,onChange:()=>a("enableAuditLog")}),"Enable access audit log"]}),en.jsx("p",{className:y().settingDescription,children:"Keep a record of all file access operations for security purposes."})]}),(0,en.jsxs)("div",{className:y().dialogButtons,children:[en.jsx("button",{className:y().cancelButton,onClick:t,children:"Cancel"}),en.jsx("button",{className:y().saveButton,onClick:()=>{i(n),t()},children:"Save Settings"})]})]})})};function el(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ec{constructor(){el(this,"name","google-drive"),el(this,"displayName","Google Drive"),el(this,"icon","/icons/google-drive.svg"),el(this,"accessToken",null),el(this,"refreshToken",null),el(this,"expiresAt",0),el(this,"clientId",null),el(this,"clientSecret",null),el(this,"redirectUri",null),el(this,"scopes",["https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/drive.metadata.readonly","https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email"])}async connect(e){if(!e)throw Error("Google Drive connection options are required");if(this.clientId=e.clientId,this.clientSecret=e.clientSecret||null,this.redirectUri=e.redirectUri,e.scopes&&e.scopes.length>0&&(this.scopes=e.scopes),e.accessToken)return this.accessToken=e.accessToken,this.refreshToken=e.refreshToken||null,this.expiresAt=Date.now()+36e5,!0;try{let e=this.getAuthUrl();return window.open(e,"Google Drive Authorization","width=600,height=700"),new Promise(e=>{console.log("Waiting for Google Drive authorization..."),setTimeout(()=>{this.accessToken="simulated_access_token",this.refreshToken="simulated_refresh_token",this.expiresAt=Date.now()+36e5,e(!0)},1e3)})}catch(e){return console.error("Google Drive connection error:",e),!1}}async disconnect(){if(this.accessToken)try{let e=`https://accounts.google.com/o/oauth2/revoke?token=${this.accessToken}`;await fetch(e,{method:"POST"})}catch(e){console.error("Error revoking Google Drive token:",e)}this.accessToken=null,this.refreshToken=null,this.expiresAt=0}isConnected(){return!!this.accessToken&&Date.now()<this.expiresAt}async listFiles(e,t){if(!this.isConnected())throw Error("Not connected to Google Drive");try{let i=new URLSearchParams({q:`'${"/"!==e&&e?e:"root"}' in parents and trashed = false`,fields:"files(id,name,mimeType,size,modifiedTime,createdTime,thumbnailLink,webViewLink,webContentLink,shared)",pageSize:t?.limit?.toString()||"100"});if(t?.pageToken&&i.append("pageToken",t.pageToken),t?.fileType&&t.fileType.length>0){let e=t.fileType.map(e=>`mimeType contains '${e}'`).join(" or ");i.set("q",`${i.get("q")} and (${e})`)}let s=await fetch(`https://www.googleapis.com/drive/v3/files?${i.toString()}`,{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!s.ok)throw Error(`Google Drive API error: ${s.status} ${s.statusText}`);return(await s.json()).files.map(e=>({id:e.id,name:e.name,path:`/${e.name}`,isFolder:"application/vnd.google-apps.folder"===e.mimeType,mimeType:e.mimeType,size:parseInt(e.size,10)||void 0,modifiedAt:e.modifiedTime?new Date(e.modifiedTime):void 0,createdAt:e.createdTime?new Date(e.createdTime):void 0,thumbnailUrl:e.thumbnailLink,webViewUrl:e.webViewLink,webEditUrl:e.mimeType.startsWith("application/vnd.google-apps.")?e.webViewLink:void 0,metadata:{driveId:e.id,shared:!!e.shared}}))}catch(e){throw console.error("Error listing Google Drive files:",e),Error(`Failed to list files: ${e instanceof Error?e.message:String(e)}`)}}async getFileContent(e,t){if(!this.isConnected())throw Error("Not connected to Google Drive");try{let i;let s=await fetch(`https://www.googleapis.com/drive/v3/files/${e}?fields=name,mimeType,size`,{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!s.ok)throw Error(`Google Drive API error (metadata): ${s.status} ${s.statusText}`);let n=await s.json(),o=n.mimeType;if(n.mimeType.startsWith("application/vnd.google-apps.")){let s=this.getExportMimeType(n.mimeType,t?.exportFormat);if(!s)throw Error(`Unsupported export format for ${n.mimeType}`);i=`https://www.googleapis.com/drive/v3/files/${e}/export?mimeType=${s}`,o=s}else i=`https://www.googleapis.com/drive/v3/files/${e}?alt=media`;let r=await fetch(i,{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!r.ok)throw Error(`Google Drive API error (download): ${r.status} ${r.statusText}`);let a=await r.blob();return{name:n.name,mimeType:o,size:parseInt(n.size,10)||a.size,content:a,metadata:{driveId:e}}}catch(e){throw console.error("Error downloading Google Drive file:",e),Error(`Failed to download file: ${e instanceof Error?e.message:String(e)}`)}}async searchFiles(e,t){if(!this.isConnected())throw Error("Not connected to Google Drive");try{let i=new URLSearchParams({q:`name contains '${e}' and trashed = false`,fields:"files(id,name,mimeType,size,modifiedTime,createdTime,thumbnailLink,webViewLink,webContentLink,shared)",pageSize:t?.limit?.toString()||"100"});t?.folderId&&i.set("q",`${i.get("q")} and '${t.folderId}' in parents`),t?.pageToken&&i.append("pageToken",t.pageToken);let s=await fetch(`https://www.googleapis.com/drive/v3/files?${i.toString()}`,{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!s.ok)throw Error(`Google Drive API error: ${s.status} ${s.statusText}`);return(await s.json()).files.map(e=>({id:e.id,name:e.name,path:`/${e.name}`,isFolder:"application/vnd.google-apps.folder"===e.mimeType,mimeType:e.mimeType,size:parseInt(e.size,10)||void 0,modifiedAt:e.modifiedTime?new Date(e.modifiedTime):void 0,createdAt:e.createdTime?new Date(e.createdTime):void 0,thumbnailUrl:e.thumbnailLink,webViewUrl:e.webViewLink,webEditUrl:e.mimeType.startsWith("application/vnd.google-apps.")?e.webViewLink:void 0,metadata:{driveId:e.id,shared:!!e.shared}}))}catch(e){throw console.error("Error searching Google Drive files:",e),Error(`Failed to search files: ${e instanceof Error?e.message:String(e)}`)}}async getUserInfo(){if(!this.isConnected())throw Error("Not connected to Google Drive");try{let e=await fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json",{headers:{Authorization:`Bearer ${this.accessToken}`}});if(!e.ok)throw Error(`Google Drive API error: ${e.status} ${e.statusText}`);let t=await e.json();return{id:t.id,name:t.name,email:t.email,avatarUrl:t.picture,metadata:{locale:t.locale}}}catch(e){throw console.error("Error getting Google Drive user info:",e),Error(`Failed to get user info: ${e instanceof Error?e.message:String(e)}`)}}getAuthUrl(){if(!this.clientId||!this.redirectUri)throw Error("Client ID and redirect URI are required");let e=new URLSearchParams({client_id:this.clientId,redirect_uri:this.redirectUri,response_type:"code",scope:this.scopes.join(" "),access_type:"offline",prompt:"consent"});return`https://accounts.google.com/o/oauth2/v2/auth?${e.toString()}`}getExportMimeType(e,t){return"application/vnd.google-apps.document"===e?"pdf"===t?"application/pdf":"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"application/vnd.google-apps.spreadsheet"===e?"csv"===t?"text/csv":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/vnd.google-apps.presentation"===e?"pdf"===t?"application/pdf":"application/vnd.openxmlformats-officedocument.presentationml.presentation":null}}function ed(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class eu{constructor(){ed(this,"name","dropbox"),ed(this,"displayName","Dropbox"),ed(this,"icon","/icons/dropbox.svg"),ed(this,"accessToken",null),ed(this,"refreshToken",null),ed(this,"expiresAt",0),ed(this,"clientId",null),ed(this,"clientSecret",null),ed(this,"redirectUri",null),ed(this,"scopes",["files.metadata.read","files.content.read","account_info.read"])}getAuthUrl(){if(!this.clientId||!this.redirectUri)throw Error("Client ID and redirect URI are required");let e=new URLSearchParams({client_id:this.clientId,redirect_uri:this.redirectUri,response_type:"code",token_access_type:"offline"});return this.scopes.length>0&&e.append("scope",this.scopes.join(" ")),`https://www.dropbox.com/oauth2/authorize?${e.toString()}`}async connect(e){if(!e)throw Error("Dropbox connection options are required");if(this.clientId=e.clientId,this.clientSecret=e.clientSecret||null,this.redirectUri=e.redirectUri,e.scopes&&e.scopes.length>0&&(this.scopes=e.scopes),e.accessToken)return this.accessToken=e.accessToken,this.refreshToken=e.refreshToken||null,this.expiresAt=Date.now()+36e5,!0;try{let e=this.getAuthUrl();return window.open(e,"Dropbox Authorization","width=600,height=700"),new Promise(e=>{console.log("Waiting for Dropbox authorization..."),setTimeout(()=>{this.accessToken="simulated_access_token",this.refreshToken="simulated_refresh_token",this.expiresAt=Date.now()+36e5,e(!0)},1e3)})}catch(e){return console.error("Dropbox connection error:",e),!1}}async disconnect(){if(this.accessToken)try{await fetch("https://api.dropboxapi.com/2/auth/token/revoke",{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}})}catch(e){console.error("Error revoking Dropbox token:",e)}this.accessToken=null,this.refreshToken=null,this.expiresAt=0}isConnected(){return!!this.accessToken&&Date.now()<this.expiresAt}async listFiles(e,t){if(!this.isConnected())throw Error("Not connected to Dropbox");try{let i=e.startsWith("/")?e:`/${e}`,s=await fetch("https://api.dropboxapi.com/2/files/list_folder",{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({path:"/"===i?"":i,recursive:!1,include_media_info:!0,include_deleted:!1,include_has_explicit_shared_members:!0,limit:t?.limit||100})});if(!s.ok)throw Error(`Dropbox API error: ${s.status} ${s.statusText}`);return(await s.json()).entries.map(e=>({id:e.id,name:e.name,path:e.path_display,isFolder:"folder"===e[".tag"],mimeType:"file"===e[".tag"]?this.getMimeType(e.name):void 0,size:e.size,modifiedAt:e.server_modified?new Date(e.server_modified):void 0,createdAt:e.client_modified?new Date(e.client_modified):void 0,thumbnailUrl:e.thumbnail_url,webViewUrl:e.preview_url,metadata:{dropboxId:e.id,shared:!!e.shared_folder_id}}))}catch(e){throw console.error("Error listing Dropbox files:",e),Error(`Failed to list files: ${e instanceof Error?e.message:String(e)}`)}}async getFileContent(e,t){if(!this.isConnected())throw Error("Not connected to Dropbox");try{let t=e.startsWith("/")?e:`/${e}`,i=await fetch("https://api.dropboxapi.com/2/files/get_metadata",{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({path:t,include_media_info:!0})});if(!i.ok)throw Error(`Dropbox API error: ${i.status} ${i.statusText}`);let s=await i.json(),n=await fetch("https://content.dropboxapi.com/2/files/download",{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Dropbox-API-Arg":JSON.stringify({path:t})}});if(!n.ok)throw Error(`Dropbox download error: ${n.status} ${n.statusText}`);let o=await n.blob();return{name:s.name,mimeType:this.getMimeType(s.name),size:s.size,content:o,metadata:{dropboxId:s.id,shared:!!s.shared_folder_id}}}catch(e){throw console.error("Error downloading Dropbox file:",e),Error(`Failed to download file: ${e instanceof Error?e.message:String(e)}`)}}async searchFiles(e,t){if(!this.isConnected())throw Error("Not connected to Dropbox");try{let i=await fetch("https://api.dropboxapi.com/2/files/search_v2",{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"},body:JSON.stringify({query:e,options:{path:t?.folderId||"",max_results:t?.limit||100,file_status:"active"},match_field_options:{include_highlights:!1}})});if(!i.ok)throw Error(`Dropbox API error: ${i.status} ${i.statusText}`);return(await i.json()).matches.map(e=>{let t=e.metadata.metadata;return{id:t.id,name:t.name,path:t.path_display,isFolder:"folder"===t[".tag"],mimeType:"file"===t[".tag"]?this.getMimeType(t.name):void 0,size:t.size,modifiedAt:t.server_modified?new Date(t.server_modified):void 0,createdAt:t.client_modified?new Date(t.client_modified):void 0,metadata:{dropboxId:t.id,shared:!!t.shared_folder_id}}})}catch(e){throw console.error("Error searching Dropbox files:",e),Error(`Failed to search files: ${e instanceof Error?e.message:String(e)}`)}}async getUserInfo(){if(!this.isConnected())throw Error("Not connected to Dropbox");try{let e=await fetch("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${this.accessToken}`}});if(!e.ok)throw Error(`Dropbox API error: ${e.status} ${e.statusText}`);let t=await e.json();return{id:t.account_id,name:`${t.name.given_name} ${t.name.surname}`.trim(),email:t.email,avatarUrl:t.profile_photo_url,metadata:{dropboxId:t.account_id,country:t.country,locale:t.locale,accountType:t.account_type[".tag"]}}}catch(e){throw console.error("Error getting Dropbox user info:",e),Error(`Failed to get user info: ${e instanceof Error?e.message:String(e)}`)}}getMimeType(e){return({pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",csv:"text/csv"})[e.split(".").pop()?.toLowerCase()??""]||"application/octet-stream"}}function eh(e,t,i){var s;return(t="symbol"==typeof(s=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?s:String(s))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let ep=function(e){return e.DISCONNECTED="disconnected",e.CONNECTING="connecting",e.CONNECTED="connected",e.ERROR="error",e}({});class em{static getInstance(){return em.instance||(em.instance=new em),em.instance}constructor(){eh(this,"providers",new Map),this.registerProvider(new ec),this.registerProvider(new eu)}registerProvider(e){this.providers.set(e.name,{provider:e,status:ep.DISCONNECTED})}getProviders(){return Array.from(this.providers.values())}getProvider(e){return this.providers.get(e)}async connectProvider(e,t){let i=this.providers.get(e);if(!i)throw Error(`Provider ${e} not found`);try{if(i.status=ep.CONNECTING,!await i.provider.connect(t))return i.status=ep.ERROR,i.error="Connection failed",!1;i.status=ep.CONNECTED,i.lastConnected=new Date;try{i.userInfo=await i.provider.getUserInfo()}catch(t){console.warn(`Failed to get user info for ${e}:`,t)}return!0}catch(e){return i.status=ep.ERROR,i.error=e instanceof Error?e.message:String(e),!1}}async disconnectProvider(e){let t=this.providers.get(e);if(!t)throw Error(`Provider ${e} not found`);try{await t.provider.disconnect(),t.status=ep.DISCONNECTED,t.userInfo=void 0}catch(t){throw console.error(`Error disconnecting from ${e}:`,t),t}}isProviderConnected(e){let t=this.providers.get(e);return!!t&&t.status===ep.CONNECTED}}eh(em,"instance",void 0);let ef=({onTasksExtracted:e,className:t})=>{let{0:i,1:s}=(0,f.useState)("text"),{0:n,1:o}=(0,f.useState)(""),{0:r,1:a}=(0,f.useState)(!1),{0:l,1:c}=(0,f.useState)(null),{0:d,1:u}=(0,f.useState)(null),{0:h,1:p}=(0,f.useState)(!1),{0:m,1:g}=(0,f.useState)(!1),{0:v,1:w}=(0,f.useState)(null),_=(0,f.useRef)(null),E=new es,b=em.getInstance(),C=et.getInstance(),T=e=>{s(e),o(""),c(null),u(null)},x=e=>{o(e.target.value)},N=async e=>{let t=e.target.files?.[0];if(t)try{let e=await I(t);o(e)}catch(e){u(`Error reading file: ${e instanceof Error?e.message:String(e)}`)}},I=e=>new Promise((t,i)=>{let s=new FileReader;s.onload=e=>t(e.target?.result),s.onerror=e=>i(e),s.readAsText(e)}),A=async()=>{if(!n.trim()){u("Please enter some content to analyze");return}a(!0),u(null),c(null);try{let t={content:n,contentType:i};"cloud"===i&&v&&(t.sourceProvider=v,t.sourceId="file-id");let s=await E.analyzeContent(t);c(s),s.tasks&&e&&e(s.tasks)}catch(e){u(`Analysis failed: ${e instanceof Error?e.message:String(e)}`)}finally{a(!1)}},S=()=>{g(!m)},O=e=>{w(e)};return(0,en.jsxs)("div",{className:`${y().flowsistant} ${t||""}`,children:[(0,en.jsxs)("div",{className:y().header,children:[en.jsx("h2",{children:"The Flowsistant"}),en.jsx("p",{children:"Powered by Google Gemini Flash 2.0"})]}),(0,en.jsxs)("div",{className:y().inputTypeSelector,children:[en.jsx("button",{className:`${y().typeButton} ${"text"===i?y().active:""}`,onClick:()=>T("text"),children:"Text"}),en.jsx("button",{className:`${y().typeButton} ${"file"===i?y().active:""}`,onClick:()=>T("file"),children:"File"}),en.jsx("button",{className:`${y().typeButton} ${"email"===i?y().active:""}`,onClick:()=>T("email"),children:"Email"}),en.jsx("button",{className:`${y().typeButton} ${"cloud"===i?y().active:""}`,onClick:()=>{p(!h),h?s("text"):s("cloud")},children:"Cloud Storage"}),en.jsx("button",{className:y().privacyButton,onClick:S,title:"Configure privacy settings",children:"Privacy Settings"})]}),(0,en.jsxs)("div",{className:y().inputContainer,children:["text"===i&&en.jsx("textarea",{className:y().textInput,placeholder:"Enter text to analyze...",value:n,onChange:x,rows:8}),"file"===i&&(0,en.jsxs)("div",{className:y().fileInput,children:[en.jsx("input",{type:"file",ref:_,onChange:N,accept:".txt,.md,.doc,.docx,.pdf",style:{display:"none"}}),en.jsx("button",{className:y().fileButton,onClick:()=>_.current?.click(),children:"Select File"}),n?(0,en.jsxs)("div",{className:y().filePreview,children:[(0,en.jsxs)("p",{children:["File content loaded (",n.length," characters)"]}),(0,en.jsxs)("div",{className:y().previewContent,children:[n.substring(0,100),"..."]})]}):en.jsx("p",{children:"Supported formats: .txt, .md, .doc, .docx, .pdf"})]}),"email"===i&&en.jsx("textarea",{className:y().textInput,placeholder:"Paste email content here...",value:n,onChange:x,rows:8}),"cloud"===i&&h&&(0,en.jsxs)("div",{className:y().cloudStorageContainer,children:[en.jsx("div",{className:y().providerList,children:b.getProviders().map(e=>(0,en.jsxs)("button",{className:`${y().providerButton} ${v===e.provider.name?y().active:""}`,onClick:()=>O(e.provider.name),children:[en.jsx("img",{src:e.provider.icon,alt:e.provider.displayName,className:y().providerIcon}),en.jsx("span",{children:e.provider.displayName})]},e.provider.name))}),v&&(0,en.jsxs)("div",{className:y().fileSelector,children:[(0,en.jsxs)("p",{children:["Connect to ",v," to select files"]}),(0,en.jsxs)("button",{className:y().connectButton,onClick:()=>{let e={clientId:"demo-client-id",redirectUri:window.location.origin+"/auth/callback"};b.connectProvider(v,e)},children:["Connect to ",v]}),(0,en.jsxs)("p",{className:y().privacyNote,children:["Your privacy is important. Files processed according to",en.jsx("button",{className:y().privacyLink,onClick:S,children:"privacy settings"}),"."]})]})]}),n&&en.jsx("button",{className:y().analyzeButton,onClick:A,disabled:r||!n.trim(),children:r?"Analyzing...":"Analyze with Flowsistant"})]}),d&&en.jsx("div",{className:y().error,children:d}),m&&en.jsx(ea,{providerId:v,onClose:S,onSave:e=>{C.updatePrivacySettings(e)}})]})};var eg=i(69765),ey=i.n(eg);function ev(){let{0:e,1:t}=(0,f.useState)([]);return(0,en.jsxs)("div",{className:ey().container,children:[(0,en.jsxs)("div",{className:ey().header,children:[en.jsx("h1",{children:"The Flowsistant"}),en.jsx("p",{children:"Use the power of Google's Gemini Flash 2.0 to analyze text, files, or emails and automatically extract tasks for your flow."})]}),(0,en.jsxs)("div",{className:ey().content,children:[en.jsx("div",{className:ey().assistantContainer,children:en.jsx(ef,{onTasksExtracted:e=>{t(e)}})}),e.length>0&&(0,en.jsxs)("div",{className:ey().extractedTasksContainer,children:[en.jsx("h2",{children:"Tasks Ready for Flow"}),en.jsx("p",{children:"These tasks have been extracted and are ready to be added to your flow."}),en.jsx("div",{className:ey().taskList,children:e.map((e,t)=>(0,en.jsxs)("div",{className:ey().taskCard,children:[en.jsx("h3",{children:e.title}),e.description&&en.jsx("p",{children:e.description}),(0,en.jsxs)("div",{className:ey().taskMeta,children:[e.priority&&en.jsx("span",{className:`${ey().priority} ${ey()[e.priority.toLowerCase()]}`,children:e.priority}),e.dueDate&&(0,en.jsxs)("span",{className:ey().dueDate,children:["Due: ",e.dueDate]})]})]},t))}),en.jsx("div",{className:ey().actions,children:en.jsx("button",{className:ey().addToFlowButton,onClick:()=>{alert(`${e.length} tasks added to your flow!`),t([])},children:"Add All to Flow"})})]})]})]})}},69765:e=>{e.exports={container:"page_container__LHNtC",header:"page_header__ubmQ9",content:"page_content__t2HCM",assistantContainer:"page_assistantContainer__WNAjM",extractedTasksContainer:"page_extractedTasksContainer__kN98t",taskList:"page_taskList__5Gynr",taskCard:"page_taskCard__RAgXF",taskMeta:"page_taskMeta__mPXVN",priority:"page_priority__KfPfX",high:"page_high__edJXd",medium:"page_medium__z43rA",low:"page_low__eYLGW",dueDate:"page_dueDate__P8_hS",actions:"page_actions__emkf6",addToFlowButton:"page_addToFlowButton___TcCy"}},65650:e=>{e.exports={flowsistant:"styles_flowsistant__5dlTT",header:"styles_header__1VLhP",inputTypeSelector:"styles_inputTypeSelector__UmzXr",typeButton:"styles_typeButton__Dk1W6",active:"styles_active__STIJL",inputContainer:"styles_inputContainer__x7jYk",textInput:"styles_textInput__PPA28",fileInput:"styles_fileInput__4rFV0",fileButton:"styles_fileButton__jJgsE",filePreview:"styles_filePreview__4HvW0",previewContent:"styles_previewContent___AcbY",analyzeButton:"styles_analyzeButton__VGSzo",error:"styles_error__g4yGq",results:"styles_results__R_vCB",section:"styles_section__8p08i",taskList:"styles_taskList__ojKQ7",taskItem:"styles_taskItem__fKphB",taskTitle:"styles_taskTitle__peyOz",taskDescription:"styles_taskDescription__fIr43",taskPriority:"styles_taskPriority__ZJkO2",taskDueDate:"styles_taskDueDate__nkN6s",addTasksButton:"styles_addTasksButton__xnsaL"}},82460:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>s});let s=(0,i(87866).createProxy)(String.raw`C:\Bollo\Github\flowstate-catalyst\src\app\flow\assistant\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[237,479,494,679,965],()=>i(73169));module.exports=s})();