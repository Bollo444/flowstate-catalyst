(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{8564:function(e,t,r){Promise.resolve().then(r.bind(r,1923))},7132:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var s=(0,r(8969).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},2921:function(e,t,r){"use strict";var s=r(6168);r.o(s,"redirect")&&r.d(t,{redirect:function(){return s.redirect}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},1923:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return eS}});var s=r(4513),n=r(90),a=r(5977),i=r.n(a),o=r(6871),c=r(2308),l=r(6437),u=r(9335),p=r(8839),d={enter:{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3}},flowPulse:{scale:[1,1.02,1],transition:{duration:2,repeat:1/0,ease:"easeInOut"}},ripple:{scale:[1,1.01,1],opacity:[.9,1,.9],transition:{duration:1.5,repeat:1/0,ease:"easeInOut"}}},m=r(5685),f=r(26),_={ACTIVE_TIME_MIN:25,ACTIVE_TIME_MAX:90,BREAK_INTERVAL:45,CONTEXT_SWITCH_PENALTY:15,TASK_COMPLETION_BONUS:10},h=function(){function e(){(0,m.Z)(this,e)}return(0,f.Z)(e,null,[{key:"calculateFlowScore",value:function(e){return Math.max(0,Math.min(100,50+this.calculateActiveTimeFactor(e.activeTime)*this.SCORE_WEIGHTS.activeTime+e.taskCompletions*_.TASK_COMPLETION_BONUS*this.SCORE_WEIGHTS.taskCompletions-e.contextSwitches*_.CONTEXT_SWITCH_PENALTY*this.SCORE_WEIGHTS.contextSwitches+this.calculateBreakFactor(e.lastBreakTime,e.activeTime)*this.SCORE_WEIGHTS.breakTiming+this.calculateTimeOptimization(e.dayProgress)*this.SCORE_WEIGHTS.timeOptimization))}},{key:"determineFlowStatus",value:function(e,t){return e>=80&&t.activeTime>=_.ACTIVE_TIME_MIN?"peak":e>=60?"flow":t.activeTime<_.ACTIVE_TIME_MIN?"building":"rest"}},{key:"calculateActiveTimeFactor",value:function(e){var t=_.ACTIVE_TIME_MAX,r=_.ACTIVE_TIME_MIN;return e<r?e/r*100:e>t?Math.max(0,100-(e-t)/30*10):100}},{key:"calculateBreakFactor",value:function(e,t){if(!e)return 50;var r=(Date.now()-e.getTime())/6e4,s=_.OPTIMAL_BREAK_INTERVAL;return r<s?100:Math.max(0,100-(r-s)/15*10)}},{key:"calculateTimeOptimization",value:function(e){for(var t=0,r=[{start:.3,end:.45,score:90},{start:.6,end:.75,score:100},{start:.8,end:.9,score:80}];t<r.length;t++){var s=r[t];if(e>=s.start&&e<=s.end)return s.score}return 70}},{key:"predictFlowTrend",value:function(e){var t=this;if(e.length<2)return"stable";var r=e.slice(-3).map(function(e){return t.calculateFlowScore(e)}),s=r[r.length-1]-r[0];return s>10?"improving":s<-10?"declining":"stable"}},{key:"createFlowState",value:function(e,t){var r=this.calculateFlowScore(t),s=this.determineFlowStatus(r,t);return{userId:e,score:r,status:s,activeTime:t.activeTime}}}]),e}();(0,s.Z)(h,"SCORE_WEIGHTS",{activeTime:.3,taskCompletions:.2,contextSwitches:.15,breakTiming:.2,timeOptimization:.15});var v=r(2003),k=r.n(v),w=r(7437),g={peak:"#50B584",flow:"#3B82F6",rest:"#8B5CF6",building:"#F59E0B"},S={peak:"Peak performance! You're in an optimal flow state.",flow:"You're in flow. Keep the momentum going!",rest:"Time to recharge. Take a short break.",building:"Building focus. Minimize distractions."},y=function(e){var t=e.score,r=e.status,s=e.metrics,n=e.showDetails;return(0,w.jsxs)(c.E.div,{className:k().flowScore,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:[(0,w.jsxs)("div",{className:k().scoreContainer,children:[(0,w.jsx)(c.E.div,{className:k().scoreCircle,style:{backgroundColor:g[r],opacity:t/100},animate:{boxShadow:"0 0 ".concat("peak"===r?"2px":"1px"," ").concat(g[r])},children:(0,w.jsx)(c.E.div,{className:k().score,animate:{scale:[1,1.1,1]},transition:{duration:2,repeat:1/0},children:t})}),(0,w.jsx)("div",{className:k().label,children:"Flow Score"})]}),(0,w.jsx)(l.M,{mode:"wait",children:(0,w.jsx)(c.E.div,{className:"".concat(k().status," ").concat(k()[r]),initial:{y:10,opacity:0},animate:{y:0,opacity:1},exit:{y:-10,opacity:0},transition:{duration:.2},children:r.charAt(0).toUpperCase()+r.slice(1)},r)}),void 0!==n&&n&&(0,w.jsxs)(c.E.div,{className:k().details,initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},transition:{duration:.3},children:[(0,w.jsx)("p",{className:k().description,children:S[r]}),(0,w.jsxs)("div",{className:k().metrics,children:[(0,w.jsxs)("div",{className:k().metric,children:[(0,w.jsx)("span",{children:"Active Time"}),(0,w.jsxs)("span",{children:[Math.floor(s.activeTime),"m"]})]}),(0,w.jsxs)("div",{className:k().metric,children:[(0,w.jsx)("span",{children:"Tasks Done"}),(0,w.jsx)("span",{children:s.taskCompletions})]}),(0,w.jsxs)("div",{className:k().metric,children:[(0,w.jsx)("span",{children:"Last Break"}),(0,w.jsx)("span",{children:s.lastBreakTime?"".concat(Math.floor((Date.now()-s.lastBreakTime.getTime())/6e4),"m ago"):"N/A"})]})]})]})]})},x=r(7110),T=r(3366),b=["participants"];function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var I=function(){var e,t,r,s,a;function o(){(0,m.Z)(this,o)}return(0,f.Z)(o,null,[{key:"start",value:(e=(0,n.Z)(i().mark(function e(){var t,r,s,n,a,o,c,l,u,p;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to start/resume flow session..."),e.next=3,this.supabase.auth.getUser();case 3:if(t=e.sent.data.user){e.next=8;break}throw console.error("User not authenticated. Cannot start session."),Error("User not authenticated");case 8:return r=t.id,e.prev=9,e.next=12,this.getActiveSession(r);case 12:if(s=e.sent){e.next=29;break}return console.log("No active session found, creating a new one."),a={userId:r,initialState:n={score:50,status:"building",activeTime:0,interruptions:0,taskCompletions:0},type:"focus",settings:this.getDefaultSettings()},e.next=19,this.create(a);case 19:return s=e.sent,e.next=22,this.supabase.from(this.FLOW_STATES_TABLE).upsert({user_id:r,score:n.score,status:n.status,active_time:n.activeTime,interruptions:n.interruptions,task_completions:n.taskCompletions,updated_at:new Date().toISOString()},{onConflict:"user_id"});case 22:return(o=e.sent.error)&&console.error("Error upserting initial flow state:",o),console.log("New session created and initial state saved:",s),e.abrupt("return",{initialState:n});case 29:return console.log("Resuming existing active session:",s.id),localStorage.setItem(this.ACTIVE_SESSION_KEY,JSON.stringify(s)),e.next=33,this.supabase.from(this.FLOW_STATES_TABLE).select("*").eq("user_id",r).single();case 33:if(l=(c=e.sent).data,!((u=c.error)||!l)){e.next=39;break}return console.error("Error fetching current flow state for resuming session:",u),e.abrupt("return",{initialState:{score:0,status:"rest",activeTime:0,interruptions:0,taskCompletions:0}});case 39:return console.log("Resumed with current state:",p={score:l.score,status:l.status,activeTime:l.active_time,interruptions:l.interruptions||0,taskCompletions:l.task_completions||0}),e.abrupt("return",{initialState:p});case 42:e.next=48;break;case 44:return e.prev=44,e.t0=e.catch(9),console.error("Error in FlowSessionService.start:",e.t0),e.abrupt("return",{initialState:{score:0,status:"rest",activeTime:0,interruptions:0,taskCompletions:0}});case 48:case"end":return e.stop()}},e,this,[[9,44]])})),function(){return e.apply(this,arguments)})},{key:"create",value:(t=(0,n.Z)(i().mark(function e(t){var r,s,n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={id:(r={id:crypto.randomUUID(),userId:t.userId,teamId:t.teamId,startTime:new Date,initialState:t.initialState,participants:new Set([t.userId]),type:t.type||"focus",settings:t.settings||this.getDefaultSettings()}).id,user_id:t.userId,team_id:t.teamId,start_time:r.startTime.toISOString(),initial_state:t.initialState,type:r.type,settings:r.settings},e.next=4,this.supabase.from(this.SESSION_TABLE).insert(s);case 4:if(!(n=e.sent.error)){e.next=8;break}throw n;case 8:return localStorage.setItem(this.ACTIVE_SESSION_KEY,JSON.stringify(r)),e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"end",value:(r=(0,n.Z)(i().mark(function e(t,r){var s,n,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Ending session: ".concat(t)),s=new Date,n={sessionId:t,duration:this.calculateDuration(r.startTime,s),flowScore:this.calculateAverageFlow(r.transitions),productivity:this.calculateProductivity(r),insights:this.generateInsights(r)},e.next=5,this.supabase.from(this.SESSION_TABLE).update({end_time:s.toISOString(),summary:n}).eq("id",t);case 5:if(!(a=e.sent.error)){e.next=9;break}throw a;case 9:return localStorage.removeItem(this.ACTIVE_SESSION_KEY),console.log("Session ".concat(t," ended. Summary:"),n),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"getActiveSession",value:(s=(0,n.Z)(i().mark(function e(t){var r,s,n,a,o,c;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Checking active session for user: ".concat(t)),!(r=localStorage.getItem(this.ACTIVE_SESSION_KEY))){e.next=17;break}if(e.prev=3,(s=JSON.parse(r)).startTime&&(s.startTime=new Date(s.startTime)),Array.isArray(s.participants)?s.participants=new Set(s.participants):s.participants=new Set([t]),!(s.id&&s.startTime&&s.participants&&s.userId===t)){e.next=11;break}return e.abrupt("return",s);case 11:localStorage.removeItem(this.ACTIVE_SESSION_KEY);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),localStorage.removeItem(this.ACTIVE_SESSION_KEY);case 17:return e.next=19,this.supabase.from(this.SESSION_TABLE).select("*").eq("user_id",t).is("end_time",null).maybeSingle();case 19:if(a=(n=e.sent).data,!(o=n.error)){e.next=25;break}return console.error("Error fetching active session from DB:",o),e.abrupt("return",null);case 25:if(!a){e.next=29;break}return c={id:a.id,userId:a.user_id,teamId:a.team_id,startTime:new Date(a.start_time),participants:new Set([t]),type:a.type||"focus",initialState:a.initial_state||void 0,settings:a.settings||void 0},localStorage.setItem(this.ACTIVE_SESSION_KEY,JSON.stringify(c)),e.abrupt("return",c);case 29:return e.abrupt("return",null);case 30:case"end":return e.stop()}},e,this,[[3,14]])})),function(e){return s.apply(this,arguments)})},{key:"recordInterruption",value:(a=(0,n.Z)(i().mark(function e(t,r){var s,n,a,o,c,l,u,p,d,m,f,_,h,v,k;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Recording interruption: ".concat(t,", Recovery: ").concat(r,"ms")),e.next=3,this.supabase.auth.getUser();case 3:if(s=e.sent.data.user){e.next=7;break}throw Error("User not authenticated");case 7:return n=s.id,e.next=10,this.getActiveSession(n);case 10:if(!(!(a=e.sent)||!a.id)){e.next=14;break}return console.error("Cannot record interruption: No active session found."),e.abrupt("return",Promise.resolve({score:0,status:"rest",activeTime:0,interruptions:0,taskCompletions:0}));case 14:return o=a.id,console.log("TODO: Insert interruption record (Session: ".concat(o,", Type: ").concat(t,")")),e.next=18,this.supabase.from(this.FLOW_STATES_TABLE).select("score, status, interruptions, active_time, task_completions").eq("user_id",n).single();case 18:if(l=(c=e.sent).data,!((u=c.error)||!l)){e.next=24;break}return console.error("Error fetching current flow state for interruption:",u),e.abrupt("return",Promise.resolve({score:40,status:"rest",activeTime:0,interruptions:1,taskCompletions:0}));case 24:return p=r/6e4*5,d=Math.max(0,l.score-p),m="rest",f=(l.interruptions||0)+1,_={score:d,status:m,activeTime:l.active_time,interruptions:f,taskCompletions:l.task_completions||0},e.next=31,this.supabase.from(this.FLOW_STATES_TABLE).update({score:_.score,status:_.status,interruptions:_.interruptions,updated_at:new Date().toISOString()}).eq("user_id",n);case 31:if(!(h=e.sent.error)){e.next=37;break}return console.error("Error updating flow_states after interruption:",h),v={score:l.score,status:l.status,activeTime:l.active_time,interruptions:l.interruptions||0,taskCompletions:l.task_completions||0},e.abrupt("return",Promise.resolve(v));case 37:return k=JSON.parse(localStorage.getItem(this.ACTIVE_SESSION_KEY)||"{}"),localStorage.setItem(this.ACTIVE_SESSION_KEY,JSON.stringify(j({},k))),console.log("Interruption recorded, updated state:",_),e.abrupt("return",Promise.resolve(_));case 41:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"calculateProductivity",value:function(e){if(!e||!Array.isArray(e.transitions))return 0;var t=e.transitions.reduce(function(e,t){return e+((null==t?void 0:t.duration)||0)},0);return 0===t?0:Math.round(e.transitions.filter(function(e){return e&&("flow"===e.to||"peak"===e.to)}).reduce(function(e,t){return e+((null==t?void 0:t.duration)||0)},0)/t*100)}},{key:"getDefaultSettings",value:function(){return{}}},{key:"prepareSessionData",value:function(e){return e.participants,j({},(0,T.Z)(e,b))}},{key:"calculateDuration",value:function(e,t){var r="string"==typeof e?new Date(e).getTime():e.getTime();return Math.max(0,("string"==typeof t?new Date(t).getTime():t.getTime())-r)}},{key:"calculateAverageFlow",value:function(e){return 50}},{key:"generateInsights",value:function(e){return{}}}]),o}();function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(0,s.Z)(I,"ACTIVE_SESSION_KEY","activeFlowSession"),(0,s.Z)(I,"SESSION_TABLE","flow_sessions"),(0,s.Z)(I,"FLOW_STATES_TABLE","flow_states"),(0,s.Z)(I,"INTERRUPTIONS_TABLE","flow_interruptions"),(0,s.Z)(I,"supabase",p.OQ);var N=null,A=0;function F(){var e=new Date,t=new Date(e);t.setHours(9,0,0,0);var r=new Date(e);r.setHours(17,0,0,0);var s=r.getTime()-t.getTime(),n=e.getTime()-t.getTime();return s<=0?0:Math.max(0,Math.min(1,n/s))}function P(){console.log("stopMetricsTracking called (basic implementation)"),N&&(clearInterval(N),N=null),console.log("Metrics tracking stopped.")}function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var M=["completion_metrics"];function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var R={priority:50,flow_optimal:!1,context_cost:0,completed:!1,status:"active",completion_metrics:{progress:0}};function H(e,t,r){return e?Math.min(1,Math.max(0,(e.project_id===t.project_id?.1:.4)*(1+(50-r.score)/50))):0}function U(){return(U=(0,n.Z)(i().mark(function e(t){var r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.OQ.from("tasks").delete().eq("id",t);case 2:if(!(r=e.sent.error)){e.next=7;break}throw console.error("Error deleting task:",r),r;case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function V(e){return q.apply(this,arguments)}function q(){return(q=(0,n.Z)(i().mark(function e(t){var r,s,n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.OQ.from("tasks").select("*").eq("id",t).single();case 2:if(s=(r=e.sent).data,!(n=r.error)){e.next=8;break}return console.error("Error getting task:",n),e.abrupt("return",null);case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}var W=function(){var e,t,r,s,a;function o(e){(0,m.Z)(this,o),this.userId=e}return(0,f.Z)(o,[{key:"getUserTasks",value:(e=(0,n.Z)(i().mark(function e(t){var r,s,n,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.OQ.from("tasks").select("*").eq("user_id",this.userId).in("status",["active","completed","archived"]),t&&(r=r.eq("team_id",t)),e.next=4,r.order("created_at",{ascending:!1});case 4:if(n=(s=e.sent).data,!(a=s.error)){e.next=10;break}return console.error("Error fetching user tasks:",a),e.abrupt("return",[]);case 10:return e.abrupt("return",n||[]);case 11:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"createTask",value:(t=(0,n.Z)(i().mark(function e(t){var r,s,n,a,o,c,l;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object.keys(a=L(L(L({},R),t),{},{status:t.status||"active",user_id:this.userId,priority:null!==(r=t.priority)&&void 0!==r?r:R.priority,flow_optimal:null!==(s=t.flowOptimal)&&void 0!==s?s:R.flow_optimal,context_cost:null!==(n=t.context_cost)&&void 0!==n?n:R.context_cost,estimated_duration:t.estimated_duration})).forEach(function(e){return void 0===a[e]&&delete a[e]}),e.next=4,p.OQ.from("tasks").insert(a).select().single();case 4:if(c=(o=e.sent).data,!(l=o.error)){e.next=10;break}throw console.error("Error in TaskFlowService.createTask:",l),l;case 10:if(c){e.next=12;break}throw Error("Task creation returned no data.");case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"updateTaskFlowMetrics",value:(r=(0,n.Z)(i().mark(function e(t,r){var s,n,a,o,c,l,u,d,m,f,_,h,v,k,w;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(t);case 2:if(f=e.sent){e.next=5;break}throw Error("Task not found: ".concat(t));case 5:return _=null!==(s=f.estimated_duration)&&void 0!==s?s:0,h=f.completion_metrics||{},v=(null!==(n=null!==(a=r.flowScore)&&void 0!==a?a:h.flowScore)&&void 0!==n?n:0)>=70&&(null!==(o=null!==(c=r.completionTime)&&void 0!==c?c:h.completionTime)&&void 0!==o?o:1/0)<=_,k=L(L({},h),{},{flowScore:null!==(l=r.flowScore)&&void 0!==l?l:h.flowScore,completionTime:null!==(u=r.completionTime)&&void 0!==u?u:h.completionTime,progress:null!==(d=r.progress)&&void 0!==d?d:h.progress,lastNote:null!==(m=r.lastNote)&&void 0!==m?m:h.lastNote,lastUpdate:new Date().toISOString()}),e.next=11,p.OQ.from("tasks").update({flow_optimal:v,completion_metrics:k}).eq("id",t);case 11:if(!(w=e.sent.error)){e.next=16;break}throw console.error("Failed to update task metrics for ".concat(t,":"),w),w;case 16:case"end":return e.stop()}},e)})),function(e,t){return r.apply(this,arguments)})},{key:"updateTask",value:(s=(0,n.Z)(i().mark(function e(t,r){var s,n,a,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.completion_metrics,!(Object.keys(n=(0,T.Z)(r,M)).length>0)){e.next=9;break}return e.next=4,p.OQ.from("tasks").update(n).eq("id",t);case 4:if(!(a=e.sent.error)){e.next=9;break}throw console.error("Failed to update task fields for ".concat(t,":"),a),a;case 9:if(!s){e.next=12;break}return e.next=12,this.updateTaskFlowMetrics(t,s);case 12:return e.next=14,V(t);case 14:if(o=e.sent){e.next=17;break}throw Error("Failed to refetch updated task ".concat(t));case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"subscribeToTaskUpdates",value:function(e,t){var r=this,s=p.OQ.channel("public:tasks:user=".concat(this.userId));return s.on("postgres_changes",{event:"*",schema:"public",table:"tasks",filter:"user_id=eq.".concat(this.userId)},function(e){console.log("Task change received!",e),t()}).subscribe(function(e,t){"SUBSCRIBED"===e&&console.log("Subscribed to task updates for user:",r.userId),"CHANNEL_ERROR"===e&&console.error("Task subscription error:",t),"TIMED_OUT"===e&&console.warn("Task subscription timed out.")}),s}}],[{key:"calculateTaskPriority",value:function(e,t){var r,s,n,a=e.priority;"peak"===t.currentFlowState.status?a+=this.FLOW_OPTIMAL_BONUS:"rest"===t.currentFlowState.status&&(a-=10),t.previousTaskId&&(null!==(r=e.context_cost)&&void 0!==r?r:0)>this.CONTEXT_SWITCH_THRESHOLD&&(a-=this.TASK_SWITCH_PENALTY*(null!==(n=e.context_cost)&&void 0!==n?n:0));var i=Math.max(90-t.activeTaskTime,0);return(null!==(s=e.estimated_duration)&&void 0!==s?s:30)>i&&(a-=15),Math.max(0,Math.min(100,a))}},{key:"getOptimalTasks",value:(a=(0,n.Z)(i().mark(function e(t,r){var s,n,a,o,c=this;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.OQ.from("tasks").select("*").eq("user_id",t).eq("status","active").order("priority",{ascending:!1});case 2:if(n=(s=e.sent).data,!(a=s.error)){e.next=7;break}throw a;case 7:return o={currentFlowState:r,activeTaskTime:r.activeTime,taskSwitches:0},e.abrupt("return",n?n.map(function(e){return L(L({},e),{},{priority:c.calculateTaskPriority(e,o)})}).sort(function(e,t){return t.priority-e.priority}):[]);case 9:case"end":return e.stop()}},e)})),function(e,t){return a.apply(this,arguments)})}]),o}();function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(0,s.Z)(W,"CONTEXT_SWITCH_THRESHOLD",.3),(0,s.Z)(W,"FLOW_OPTIMAL_BONUS",20),(0,s.Z)(W,"TASK_SWITCH_PENALTY",15),(0,s.Z)(W,"calculateContextSwitch",H),(0,s.Z)(W,"suggestBreak",function(e){return e.activeTime>90||e.score<40||"rest"===e.status}),(0,s.Z)(W,"predictTaskSuccess",function(e,t){return Math.max(0,Math.min(1,t.score/100*Math.min(1,(90-t.activeTime)/(e.estimated_duration||30))*(1-.5*(e.context_cost||0))))});var K=function(e){var t;return{id:e.id,title:e.title,description:e.description,status:e.status,createdAt:e.created_at,userId:e.user_id,priority:e.priority,flowOptimal:e.flow_optimal,contextCost:e.context_cost,completed:e.completed,completionMetrics:e.completion_metrics,estimatedDuration:e.estimated_duration,teamId:e.team_id,projectId:e.project_id,dueDate:null!==(t=e.due_date)&&void 0!==t?t:void 0}};function Q(e){var t,r,s,a,c,l,u,p,d,m,f,_,v,k,w,g,S,y=e.userId,T=e.teamId,b=(0,o.useState)([]),O=b[0],j=b[1],E=(0,o.useState)(!0),D=E[0],M=E[1],B=(0,o.useState)(null),L=B[0],R=B[1],V=(0,o.useState)(null),q=V[0],Y=V[1],Q=(r=(t=(0,o.useState)({score:0,status:"rest",activeTime:0,interruptions:0,taskCompletions:0}))[0],s=t[1],c=(a=(0,o.useState)({activeTime:0,interruptions:0,taskCompletions:0,contextSwitches:0,interruptedTime:0,dayProgress:F(),lastBreakTime:void 0}))[0],l=a[1],p=(u=(0,o.useState)(null))[0],d=u[1],m=(0,o.useCallback)((0,n.Z)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.start();case 3:s(e.sent.initialState),d(Date.now()),console.log("startMetricsTracking called (basic implementation)"),N&&clearInterval(N),Date.now(),A=0,console.log("Metrics tracking started."),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to start flow session:",e.t0);case 12:case"end":return e.stop()}},e,null,[[0,9]])})),[]),f=(0,o.useCallback)((0,n.Z)(i().mark(function e(){var t,n,a,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=(null==(n=(t=localStorage.getItem("activeFlowSession"))?JSON.parse(t):{})?void 0:n.id)||"unknown-session",o={startTime:new Date(p||(null==n?void 0:n.startTime)||Date.now()),transitions:[],taskCompletions:r.taskCompletions},e.next=8,I.end(a,o);case 8:s(function(e){return Z(Z({},e),{},{status:"rest"})}),d(null),P(),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Failed to end flow session:",e.t0),s(function(e){return Z(Z({},e),{},{status:"rest"})}),d(null),P();case 19:case"end":return e.stop()}},e,null,[[0,13]])})),[r.taskCompletions,p]),v=(0,o.useCallback)((_=(0,n.Z)(i().mark(function e(t,r){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.recordInterruption(t,r);case 3:s(e.sent),l(function(e){return Z(Z({},e),{},{interruptions:e.interruptions+1,interruptedTime:e.interruptedTime+r/6e4})}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed to record interruption:",e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(e,t){return _.apply(this,arguments)}),[]),(0,o.useEffect)(function(){var e=null;return"rest"!==r.status&&(e=setInterval(function(){l(function(e){var t=(console.log("calculateCurrentMetrics called (basic implementation)"),A+=1,C(C({},e),{},{activeTime:A,dayProgress:F()})),r=h.calculateFlowScore(t),n=h.determineFlowStatus(r,t);return s(function(e){return Z(Z({},e),{},{score:r,status:n,activeTime:t.activeTime})}),t})},6e4)),function(){e&&clearInterval(e)}},[r.status]),{flowState:r,metrics:c,startFlowSession:m,endFlowSession:f,recordInterruption:v}).flowState,z=(0,o.useMemo)(function(){return new W(y)},[y]),J=(0,o.useCallback)((0,n.Z)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return M(!0),e.prev=1,R(null),e.next=5,z.getUserTasks(T);case 5:j(e.sent.map(K)),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("Error fetching tasks:",e.t0),j([]),R(e.t0 instanceof Error?e.t0:Error("Failed to fetch tasks"));case 14:return e.prev=14,M(!1),e.finish(14);case 17:case"end":return e.stop()}},e,null,[[1,9,14,17]])})),[z,T]),X=(0,o.useCallback)((k=(0,n.Z)(i().mark(function e(t){var r,s,n,a,o,c,l,u,p,d,m,f;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(null),d=H(null,{id:"",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),user_id:y,title:t.title,description:null!==(r=t.description)&&void 0!==r?r:null,priority:null!==(s=t.priority)&&void 0!==s?s:50,flow_optimal:null!==(n=t.flow_optimal)&&void 0!==n&&n,context_cost:null!==(a=t.context_cost)&&void 0!==a?a:0,estimated_duration:t.estimated_duration,completed:!1,team_id:null!==(o=t.team_id)&&void 0!==o?o:null,project_id:null!==(c=t.project_id)&&void 0!==c?c:null,due_date:null!==(l=t.due_date)&&void 0!==l?l:null,status:null!==(u=t.status)&&void 0!==u?u:"active",completion_metrics:null!==(p=t.completion_metrics)&&void 0!==p?p:{progress:0}},Q),m=G(G({},t),{},{context_cost:d}),e.next=7,z.createTask(m);case 7:return f=K(e.sent),j(function(e){return[].concat((0,x.Z)(e),[f])}),e.abrupt("return",f);case 13:throw e.prev=13,e.t0=e.catch(0),console.error("useFlowTasks: Error creating task:",e.t0),R(e.t0 instanceof Error?e.t0:Error("Failed to create task")),e.t0;case 18:case"end":return e.stop()}},e,null,[[0,13]])})),function(e){return k.apply(this,arguments)}),[z,Q,y]),$=(0,o.useCallback)((w=(0,n.Z)(i().mark(function e(t,r){var s;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(null),e.next=4,z.updateTask(t,r);case 4:return s=K(e.sent),j(function(e){return e.map(function(e){return e.id===t?s:e})}),e.abrupt("return",s);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("useFlowTasks: Error updating task:",e.t0),R(e.t0 instanceof Error?e.t0:Error("Failed to update task")),e.t0;case 15:case"end":return e.stop()}},e,null,[[0,10]])})),function(e,t){return w.apply(this,arguments)}),[z]),ee=(0,o.useCallback)((g=(0,n.Z)(i().mark(function e(t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(null),e.next=4,function(e){return U.apply(this,arguments)}(t);case 4:j(function(e){return e.filter(function(e){return e.id!==t})}),e.next=12;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("useFlowTasks: Error deleting task:",e.t0),R(e.t0 instanceof Error?e.t0:Error("Failed to delete task")),e.t0;case 12:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return g.apply(this,arguments)}),[]),et=(0,o.useCallback)(function(e){Y(e),console.log("Switched active task to: ".concat(e))},[]),er=(0,o.useCallback)((S=(0,n.Z)(i().mark(function e(t){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return j(function(e){return e.map(function(e){return e.id===t?G(G({},e),{},{completed:!0,status:"completed"}):e})}),Y(null),e.prev=2,e.next=5,z.updateTask(t,{completed:!0,status:"completed"});case 5:console.log("Task marked as complete: ".concat(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("Failed to mark task as complete on server",e.t0);case 11:case"end":return e.stop()}},e,null,[[2,8]])})),function(e){return S.apply(this,arguments)}),[z]),es=(0,o.useCallback)(function(){return Q.activeTime>90||Q.score<40},[Q.activeTime,Q.score]);return(0,o.useEffect)(function(){if(y){J();var e=null;R(null);try{e=z.subscribeToTaskUpdates(T,J),console.log("Task subscription setup successfully.")}catch(e){R(e instanceof Error?e:Error("Subscription failed")),console.error("Failed to subscribe to task updates:",e)}return function(){e&&"function"==typeof e.unsubscribe?(console.log("Unsubscribing from task updates."),e.unsubscribe()):console.warn("Attempted to unsubscribe from invalid task subscription.")}}M(!1),j([]),R(null)},[y,T,J,z]),{tasks:O,loading:D,createTask:X,error:L,updateTask:$,activeTaskId:q,switchTask:et,completeTask:er,deleteTask:ee,refreshTasks:J,shouldTakeBreak:es}}var z=r(8969),J=(0,z.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),X=(0,z.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),$=(0,z.Z)("ArrowRightCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),ee=r(3926),et=r.n(ee),er=function(e){var t=e.task,r=e.isActive,s=e.onSelect,n=e.onComplete,a=(0,u.G2)().flowState,i=(0,o.useMemo)(function(){var e,s=null!==(e=t.successProbability)&&void 0!==e?e:W.predictTaskSuccess(t,a);return{isOptimal:"peak"===a.status||"flow"===a.status,probability:s,contextWarning:!r&&t.contextCost>.3,breakNeeded:W.suggestBreak(a)}},[t,a,r]);return(0,w.jsxs)(c.E.div,{className:"\n        ".concat(et().taskItem,"\n        ").concat(r?et().active:"","\n        ").concat(t.completed?et().completed:"","\n        ").concat(i.isOptimal?et().optimal:"","\n      "),onClick:function(){s&&!t.completed&&s(t.id)},initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},whileHover:{scale:1.02},whileTap:{scale:.98},children:[(0,w.jsxs)("div",{className:et().header,children:[(0,w.jsx)("h3",{className:et().title,children:t.title}),!t.completed&&(0,w.jsx)(c.E.button,{className:et().completeButton,onClick:function(e){e.stopPropagation(),n&&!t.completed&&n(t.id)},whileHover:{scale:1.1},whileTap:{scale:.9},children:(0,w.jsx)(J,{className:et().icon})})]}),t.description&&(0,w.jsx)("p",{className:et().description,children:t.description}),(0,w.jsxs)("div",{className:et().metrics,children:[(0,w.jsxs)("div",{className:et().metric,children:[(0,w.jsx)("span",{children:"Est. Duration"}),(0,w.jsxs)("span",{children:[t.estimatedDuration,"m"]})]}),(0,w.jsxs)("div",{className:et().metric,children:[(0,w.jsx)("span",{children:"Success Rate"}),(0,w.jsxs)("span",{className:"\n            ".concat(i.probability>=.7?et().high:"","\n            ").concat(i.probability<.7&&i.probability>=.4?et().medium:"","\n            ").concat(i.probability<.4?et().low:"","\n          "),children:[Math.round(100*i.probability),"%"]})]}),!r&&i.contextWarning&&(0,w.jsxs)("div",{className:et().warning,children:[(0,w.jsx)(X,{className:et().icon}),(0,w.jsx)("span",{children:"High context switch cost"})]})]}),i.breakNeeded&&r&&(0,w.jsxs)("div",{className:et().breakSuggestion,children:[(0,w.jsx)(X,{className:et().icon}),(0,w.jsx)("span",{children:"Break recommended before continuing"})]}),r&&(0,w.jsxs)(c.E.div,{className:et().flowStatus,animate:{scale:[1,1.05,1],opacity:[.8,1,.8]},transition:{duration:2,repeat:1/0},children:[(0,w.jsxs)("div",{className:et().statusIndicator,children:[(0,w.jsx)($,{className:et().icon}),(0,w.jsx)("span",{children:"In Progress"})]}),(0,w.jsxs)("div",{className:et().flowScore,children:["Flow Score: ",a.score]})]})]})},es=r(5984),en=r(7132),ea=(0,z.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),ei=r(8288),eo=r(2631),ec=r.n(eo),el=function(e){var t,r=e.userId,s=e.teamId,a=e.onCreated,l=(0,o.useState)(!1),p=l[0],d=l[1],m=(0,o.useState)(""),f=m[0],_=m[1],h=(0,o.useState)(""),v=h[0],k=h[1],g=(0,o.useState)(30),S=g[0],y=g[1],x=(0,u.G2)().flowState,T=Q({userId:r,teamId:s}).createTask,b=(0,ei.p)().toast,O=(t=(0,n.Z)(i().mark(function e(t){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,n={title:f,description:v,estimatedDuration:S,userId:r,teamId:s,contextCost:W.calculateContextSwitch("","new",x),priority:R.priority,flowOptimal:R.flowOptimal,status:R.status},e.next=6,T(n);case 6:_(""),k(""),y(30),d(!1),null==a||a(),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("Error creating task:",e.t0),b({title:"Error creating task",description:"Please try again later",variant:"destructive"});case 17:case"end":return e.stop()}},e,null,[[1,13]])})),function(e){return t.apply(this,arguments)}),j=(0,o.useCallback)(function(){return"peak"===x.status?{message:"Consider shorter tasks to maintain peak flow",type:"warning"}:"flow"===x.status?{message:"Good time to plan next tasks",type:"success"}:"rest"===x.status?{message:"Good time for task planning and organization",type:"info"}:{message:"Building focus - keep tasks manageable",type:"info"}},[x.status])();return(0,w.jsx)(c.E.div,{className:ec().taskCreate,initial:!1,animate:{height:p?"auto":"48px"},children:p?(0,w.jsxs)("form",{onSubmit:O,className:ec().createForm,children:[(0,w.jsxs)("div",{className:ec().header,children:[(0,w.jsx)("h3",{children:"Create New Task"}),(0,w.jsx)("button",{type:"button",className:ec().closeButton,onClick:function(){return d(!1)},children:"✕"})]}),(0,w.jsxs)("div",{className:ec().advice,"data-type":j.type,children:[(0,w.jsx)(X,{className:ec().icon}),(0,w.jsx)("span",{children:j.message})]}),(0,w.jsxs)("div",{className:ec().field,children:[(0,w.jsx)("label",{htmlFor:"title",children:"Title"}),(0,w.jsx)("input",{id:"title",type:"text",value:f,onChange:function(e){return _(e.target.value)},placeholder:"Task title",required:!0})]}),(0,w.jsxs)("div",{className:ec().field,children:[(0,w.jsx)("label",{htmlFor:"description",children:"Description"}),(0,w.jsx)("textarea",{id:"description",value:v,onChange:function(e){return k(e.target.value)},placeholder:"Task description (optional)",rows:3})]}),(0,w.jsxs)("div",{className:ec().field,children:[(0,w.jsxs)("label",{htmlFor:"duration",children:[(0,w.jsx)(en.Z,{className:ec().icon}),"Estimated Duration (minutes)"]}),(0,w.jsx)("input",{id:"duration",type:"number",min:5,max:180,step:5,value:S,onChange:function(e){return y(Number(e.target.value))},required:!0})]}),(0,w.jsxs)("div",{className:ec().actions,children:[(0,w.jsx)("button",{type:"button",className:ec().cancelButton,onClick:function(){return d(!1)},children:"Cancel"}),(0,w.jsxs)("button",{type:"submit",className:ec().submitButton,disabled:!f||S<5,children:["Create Task",(0,w.jsx)(ea,{className:ec().icon})]})]})]}):(0,w.jsxs)("button",{className:ec().createButton,onClick:function(){return d(!0)},children:[(0,w.jsx)(es.Z,{className:ec().icon}),(0,w.jsx)("span",{children:"Create New Task"})]})})},eu=r(1564),ep=r.n(eu),ed=function(e){var t=e.userId,r=e.teamId,s=(0,u.G2)().flowState,n=Q({userId:t,teamId:r}),a=n.tasks,i=n.loading,o=n.error,p=n.activeTaskId,d=n.switchTask,m=n.completeTask,f=n.shouldTakeBreak;if(i)return(0,w.jsxs)("div",{className:ep().loading,children:[(0,w.jsx)("div",{className:ep().pulse}),(0,w.jsx)("span",{children:"Loading tasks..."})]});if(o)return(0,w.jsxs)("div",{className:ep().error,children:[(0,w.jsxs)("p",{children:["Error loading tasks: ",o.message]}),(0,w.jsx)("button",{onClick:function(){return window.location.reload()},children:"Retry"})]});var _=f(),h=a.filter(function(e){return!e.completed}),v=a.filter(function(e){return e.completed});return(0,w.jsxs)("div",{className:ep().tasksContainer,children:[(0,w.jsx)(el,{userId:t,teamId:r}),_&&(0,w.jsxs)(c.E.div,{className:ep().breakSuggestion,initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[(0,w.jsx)("h3",{children:"Break Suggested"}),(0,w.jsx)("p",{children:s.activeTime>90?"You've been working for a while. Take a short break to maintain productivity.":"Your flow score indicates it's a good time for a break."})]}),(0,w.jsx)("div",{className:ep().tasksList,children:(0,w.jsxs)(l.M,{mode:"popLayout",children:[h.length>0?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("h2",{className:ep().sectionTitle,children:"Active Tasks"}),h.map(function(e){return(0,w.jsx)(er,{task:e,isActive:e.id===p,onSelect:d,onComplete:m},e.id)})]}):(0,w.jsx)(c.E.div,{className:ep().emptyState,initial:{opacity:0},animate:{opacity:1},children:(0,w.jsx)("p",{children:"No active tasks. Create a new task to get started!"})}),v.length>0&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("h2",{className:ep().sectionTitle,children:"Completed Tasks"}),(0,w.jsx)("div",{className:ep().completedTasks,children:v.map(function(e){return(0,w.jsx)(er,{task:e,isActive:!1},e.id)})})]})]})}),r&&a.length>0&&(0,w.jsxs)("div",{className:ep().teamStats,children:[(0,w.jsx)("h3",{children:"Team Progress"}),(0,w.jsxs)("div",{className:ep().statsGrid,children:[(0,w.jsxs)("div",{className:ep().stat,children:[(0,w.jsx)("span",{children:"Active Tasks"}),(0,w.jsx)("span",{children:h.length})]}),(0,w.jsxs)("div",{className:ep().stat,children:[(0,w.jsx)("span",{children:"Completed Today"}),(0,w.jsx)("span",{children:v.length})]}),(0,w.jsxs)("div",{className:ep().stat,children:[(0,w.jsx)("span",{children:"Team Flow Score"}),(0,w.jsx)("span",{children:Math.round(s.score)})]})]})]})]})},em=r(3292),ef=r(8120),e_=r(1005),eh=r.n(e_);function ev(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function ek(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ev(Object(r),!0).forEach(function(t){(0,s.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ev(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var ew=function(e){var t=e.initialTeamId,r=(0,u.G2)(),s=r.flowState,a=r.updateFlowState,m=(0,ef.t)(s.userId).team,f=t||(null==m?void 0:m.id);if((0,o.useEffect)(function(){var e;(e=(0,n.Z)(i().mark(function e(){var t,r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.OQ.auth.getUser();case 2:if(t=e.sent.data.user){e.next=6;break}return e.abrupt("return");case 6:r={activeTime:0,taskCompletions:0,contextSwitches:0,dayProgress:new Date().getHours()/24},a(ek(ek({},h.createFlowState(t.id,r)),{},{userId:t.id,lastUpdated:new Date().toISOString()}));case 9:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})()},[a]),!s.userId)return null;var _={activeTime:s.activeTime,taskCompletions:0,contextSwitches:0,dayProgress:new Date().getHours()/24};return(0,w.jsx)(c.E.div,{className:eh().flowContainer,initial:"initial",animate:"animate",variants:d.enter,children:(0,w.jsxs)(l.M,{children:[(0,w.jsx)(c.E.div,{className:eh().flowScoreCard,animate:d.flowPulse,children:(0,w.jsx)(y,{score:s.score,status:s.status,metrics:_,showDetails:!0})}),s.userId&&(0,w.jsx)(c.E.div,{className:eh().taskStream,variants:d.enter,children:(0,w.jsx)(ed,{userId:s.userId,teamId:f})}),(0,w.jsx)(c.E.div,{className:eh().teamSyncCard,animate:d.ripple,children:f&&(0,w.jsx)(em.F,{teamId:f,currentUserId:s.userId})})]})})},eg=r(2921);function eS(){var e=(0,p.$4)().session;return e||(0,eg.redirect)("/auth/signin"),(0,w.jsxs)("main",{children:[(0,w.jsx)(el,{userId:e.user.id}),(0,w.jsx)(ew,{})]})}},1005:function(e){e.exports={flowContainer:"FlowStateApp_flowContainer__LsY8w",flowScoreCard:"FlowStateApp_flowScoreCard__WIH7x FlowStateApp_glassPanel__27jot",taskStream:"FlowStateApp_taskStream__Itg82",teamSyncCard:"FlowStateApp_teamSyncCard___CLU1 FlowStateApp_glassPanel__27jot",enter:"FlowStateApp_enter__u0VSO",enterActive:"FlowStateApp_enterActive__Ryjhw",exit:"FlowStateApp_exit__DOGQQ",exitActive:"FlowStateApp_exitActive__utRcZ",glassPanel:"FlowStateApp_glassPanel__27jot"}},3926:function(e){e.exports={taskItem:"TaskItem_taskItem__oCSLJ",active:"TaskItem_active__HlHOQ",completed:"TaskItem_completed__CVYAi",optimal:"TaskItem_optimal__csgKa",header:"TaskItem_header__qN2Z_",title:"TaskItem_title__epY1j",description:"TaskItem_description__IVBam",completeButton:"TaskItem_completeButton__BjRVT",metrics:"TaskItem_metrics__HlX_w",metric:"TaskItem_metric__7T9i5",high:"TaskItem_high__mrbOC",medium:"TaskItem_medium__pGFIy",low:"TaskItem_low__8yToT",warning:"TaskItem_warning__bY3AZ",breakSuggestion:"TaskItem_breakSuggestion__t5Nid",icon:"TaskItem_icon__3opqs",flowStatus:"TaskItem_flowStatus__n0Ty_",statusIndicator:"TaskItem_statusIndicator__9yCKq",flowScore:"TaskItem_flowScore__pt3Sj"}},1564:function(e){e.exports={tasksContainer:"styles_tasksContainer__ZSh27",loading:"styles_loading__084Mk",pulse:"styles_pulse__oen3g",error:"styles_error__dgukj",breakSuggestion:"styles_breakSuggestion__vXhkX",tasksList:"styles_tasksList__nU6Wo",sectionTitle:"styles_sectionTitle__r2mWu",emptyState:"styles_emptyState__6k1vK",completedTasks:"styles_completedTasks__k_5Xm",teamStats:"styles_teamStats__boN8J",statsGrid:"styles_statsGrid__j042A",stat:"styles_stat__Ixv_t",taskEnter:"styles_taskEnter__k4Ty7",taskEnterActive:"styles_taskEnterActive__DuHHz",taskExit:"styles_taskExit__CdLTI",taskExitActive:"styles_taskExitActive__NAiRJ"}},2003:function(e){e.exports={flowScore:"FlowScore_flowScore__UVsS0",scoreContainer:"FlowScore_scoreContainer__ZOCAB",scoreCircle:"FlowScore_scoreCircle__AyOCF",score:"FlowScore_score__MD3Gz",label:"FlowScore_label__fraGm",status:"FlowScore_status__lWg2c",peak:"FlowScore_peak__pAQuk",flow:"FlowScore_flow__Ge1tI",rest:"FlowScore_rest__Yq2R4",building:"FlowScore_building___pNhO",details:"FlowScore_details__qmdhf",description:"FlowScore_description__Z_ZIS",metrics:"FlowScore_metrics___Hmu9",metric:"FlowScore_metric__kddDH"}},2631:function(e){e.exports={taskCreate:"Task_taskCreate__lXShc",createButton:"Task_createButton__2F51N",createForm:"Task_createForm__R0Os5",header:"Task_header__qGNTr",closeButton:"Task_closeButton__VUdZF",advice:"Task_advice__n9e4m",slideIn:"Task_slideIn__lwSv3",field:"Task_field__kyLSM",actions:"Task_actions__6DJVV",cancelButton:"Task_cancelButton__boqQG",submitButton:"Task_submitButton__00jKO",icon:"Task_icon__O5nEZ",expandForm:"Task_expandForm___YG8M"}}},function(e){e.O(0,[3866,9762,7972,2733,3877,3726,2971,529,1744],function(){return e(e.s=8564)}),_N_E=e.O()}]);