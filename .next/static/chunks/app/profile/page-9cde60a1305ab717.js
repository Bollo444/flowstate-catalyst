(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4178],{329:function(e,r,t){Promise.resolve().then(t.bind(t,4492))},4492:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return x}});var a=t(90),n=t(5977),i=t.n(n),s=t(6871),o=t(2921),l=t(8839),u=t(4513),c=t(2880),p=t(3820),d=t.n(p),f=t(7437);function h(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,a)}return t}function v(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?h(Object(t),!0).forEach(function(r){(0,u.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function m(e){var r,t,n,o=e.initialProfile,u=(0,l.$4)().supabase,p=(0,s.useState)(o),h=p[0],m=p[1],_=(0,s.useState)(null),b=_[0],x=_[1],j=(0,s.useState)(!1),g=j[0],N=j[1],P=(0,s.useState)(null),w=P[0],y=P[1],S=(0,s.useState)(!1),O=S[0],I=S[1],k=(r=(0,a.Z)(i().mark(function e(r){var t,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(t=r.target.files)||void 0===t?void 0:t[0]){e.next=3;break}return e.abrupt("return");case 3:if(!(a.size>2097152)){e.next=6;break}return y("Image size should be less than 2MB"),e.abrupt("return");case 6:x(a);case 7:case"end":return e.stop()}},e)})),function(e){return r.apply(this,arguments)}),E=(t=(0,a.Z)(i().mark(function e(r){var t,a,n,s,o,l;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),y(null),I(!1),N(!0),e.prev=4,t=h.avatar_url,!b){e.next=18;break}return a=b.name.split(".").pop(),n="".concat(h.id,"/avatar.").concat(a),e.next=11,u.storage.from("avatars").upload(n,b,{upsert:!0});case 11:if(o=(s=e.sent).error,s.data,!o){e.next=16;break}throw o;case 16:t=u.storage.from("avatars").getPublicUrl(n).data.publicUrl;case 18:return e.next=20,u.from("profiles").update(v(v({},h),{},{avatar_url:t,updated_at:new Date().toISOString()})).eq("id",h.id);case 20:if(!(l=e.sent.error)){e.next=24;break}throw l;case 24:I(!0),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),y(e.t0 instanceof Error?e.t0.message:"An error occurred");case 30:return e.prev=30,N(!1),e.finish(30);case 33:case"end":return e.stop()}},e,null,[[4,27,30,33]])})),function(e){return t.apply(this,arguments)});return(0,f.jsx)("div",{className:d().profileEditor,children:(0,f.jsxs)("form",{onSubmit:E,className:d().form,children:[w&&(0,f.jsx)("div",{className:d().error,children:w}),O&&(0,f.jsx)("div",{className:d().success,children:"Profile updated successfully"}),(0,f.jsxs)("div",{className:d().avatarSection,children:[(0,f.jsx)("div",{className:d().avatarWrapper,children:h.avatar_url?(0,f.jsx)(c.default,{src:h.avatar_url,alt:"Profile avatar",width:100,height:100,className:d().avatar}):(0,f.jsx)("div",{className:d().avatarPlaceholder,children:(null===(n=h.name)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.toUpperCase())||"?"})}),(0,f.jsxs)("div",{className:d().avatarUpload,children:[(0,f.jsx)("input",{type:"file",accept:"image/*",onChange:k,className:d().fileInput,id:"avatar"}),(0,f.jsx)("label",{htmlFor:"avatar",className:d().uploadButton,children:"Choose Image"}),b&&(0,f.jsx)("span",{className:d().fileName,children:b.name})]})]}),(0,f.jsxs)("div",{className:d().inputGroup,children:[(0,f.jsx)("label",{htmlFor:"name",children:"Name"}),(0,f.jsx)("input",{id:"name",type:"text",value:h.name||"",onChange:function(e){return m(v(v({},h),{},{name:e.target.value}))},placeholder:"Enter your name"})]}),(0,f.jsxs)("div",{className:d().inputGroup,children:[(0,f.jsx)("label",{htmlFor:"bio",children:"Bio"}),(0,f.jsx)("textarea",{id:"bio",value:h.bio||"",onChange:function(e){return m(v(v({},h),{},{bio:e.target.value}))},placeholder:"Tell us about yourself",rows:3})]}),(0,f.jsxs)("div",{className:d().inputGroup,children:[(0,f.jsx)("label",{htmlFor:"phone",children:"Phone Number"}),(0,f.jsx)("input",{id:"phone",type:"tel",value:h.phone_number||"",onChange:function(e){return m(v(v({},h),{},{phone_number:e.target.value}))},placeholder:"Enter your phone number"})]}),(0,f.jsx)("button",{type:"submit",disabled:g,className:d().submitButton,children:g?"Saving...":"Save Changes"})]})})}var _=t(8543),b=t.n(_);function x(){var e=(0,o.useRouter)(),r=(0,l.$4)(),t=r.supabase,n=r.session,u=(0,s.useState)(null),c=u[0],p=u[1],d=(0,s.useState)(!0),h=d[0],v=d[1],_=(0,s.useState)(null),x=_[0],j=_[1];return((0,s.useEffect)(function(){if(!(null!=n&&n.user)){e.push("/auth/signin");return}var r=n.user;function s(){return(s=(0,a.Z)(i().mark(function e(){var a,n,s,o,l,u;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.from("profiles").select("*").eq("user_id",r.id).single();case 3:if(n=(a=e.sent).data,!(s=a.error)){e.next=8;break}throw s;case 8:if(!n){e.next=12;break}p(n),e.next=20;break;case 12:return e.next=14,t.from("profiles").insert({id:r.id,user_id:r.id,email:r.email,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();case 14:if(l=(o=e.sent).data,!(u=o.error)){e.next=19;break}throw u;case 19:p(l);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),j(e.t0 instanceof Error?e.t0.message:"Failed to load profile");case 25:return e.prev=25,v(!1),e.finish(25);case 28:case"end":return e.stop()}},e,null,[[0,22,25,28]])}))).apply(this,arguments)}!function(){s.apply(this,arguments)}()},[n,t,e]),n)?h?(0,f.jsx)("div",{className:b().container,children:(0,f.jsx)("div",{className:b().loading,children:"Loading profile..."})}):x?(0,f.jsx)("div",{className:b().container,children:(0,f.jsxs)("div",{className:b().error,children:[x,(0,f.jsx)("button",{onClick:function(){return e.refresh()},className:b().retryButton,children:"Retry"})]})}):c?(0,f.jsxs)("div",{className:b().container,children:[(0,f.jsx)("h1",{className:b().heading,children:"Profile Settings"}),(0,f.jsx)(m,{initialProfile:c})]}):(0,f.jsx)("div",{className:b().container,children:(0,f.jsx)("div",{className:b().error,children:"Profile not found"})}):null}},8839:function(e,r,t){"use strict";t.d(r,{$4:function(){return u},OQ:function(){return l}});var a=t(90),n=t(5977),i=t.n(n),s=t(1080),o=t(6871),l=(0,s.createBrowserClient)("https://mtzhxqdhdxdwxwtfcjup.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10emh4cWRoZHhkd3h3dGZjanVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2Mzk0MjYsImV4cCI6MjA1NTIxNTQyNn0.vhZdFQUAbPG9NQoyblTrHLXBVE2gomijhz_CliAIdy8");function u(){var e=(0,o.useState)(null),r=e[0],t=e[1],n=(0,o.useState)(!0),s=n[0],u=n[1];return(0,o.useEffect)(function(){var e,r=l.auth.onAuthStateChange((e=(0,a.Z)(i().mark(function e(r,a){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t(a),u(!1);case 2:case"end":return e.stop()}},e)})),function(r,t){return e.apply(this,arguments)})).data;return l.auth.getSession().then(function(e){t(e.data.session),u(!1)}),function(){null==r||r.subscription.unsubscribe()}},[]),{supabase:l,session:r,loading:s}}},8543:function(e){e.exports={container:"profile_container__CYebx",heading:"profile_heading__xE2ln",loading:"profile_loading__P1qhx",error:"profile_error__423wL",retryButton:"profile_retryButton__EQ4fm"}},3820:function(e){e.exports={profileEditor:"Profile_profileEditor__rDg8N",form:"Profile_form__YeFQZ",avatarSection:"Profile_avatarSection__Q759l",avatarWrapper:"Profile_avatarWrapper__0wP06",avatar:"Profile_avatar__gZ8Ny",avatarPlaceholder:"Profile_avatarPlaceholder__sulJD",avatarUpload:"Profile_avatarUpload__6wMdH",fileInput:"Profile_fileInput__Fnt_S",uploadButton:"Profile_uploadButton__Ol8vD",fileName:"Profile_fileName__IuKX0",inputGroup:"Profile_inputGroup__upyt8",submitButton:"Profile_submitButton__ZwuuT",error:"Profile_error__wSh1d",success:"Profile_success__EHPp3"}}},function(e){e.O(0,[9226,9762,7972,8007,2971,529,1744],function(){return e(e.s=329)}),_N_E=e.O()}]);